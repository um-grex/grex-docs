<!doctype html><html><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=generator content="Hugo 0.152.0"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Tips on using Python on Grex for ML and other computations."><title>Using Python for ML on Grex | Grex</title><link rel=icon href=/grex-docs/logo/um_logo_vertical.png type=image/x-icon><link rel=stylesheet rel=preload type=text/css href=/grex-docs/css/main.css><link rel=stylesheet type=text/css href=/grex-docs/css/external/fontawesome.all.min.css><link rel=stylesheet type=text/css href></head><body onload=browserCompatibility()><div id=navbarInfo class="is-hidden modal-container"><div class="modal-content-box modal-text-box"><div class="card modal-title is-radiusless"><div class=card-header><p class="card-header-title is-marginless">About</p></div></div><div class=modal-content-container><div class="modal-content-block is-block"><div class='columns is-marginless is-multiline is-centered'><div class=column><a class=is-itext-link href=https://github.com/um-grex/grex-docs target=_blank><div><i class='fa-brands fa-github fa-2x'></i><p>GitHub repository</p></div></a></div><div class=column><a class=is-itext-link href=https://github.com/um-grex/grex-docs/archive/refs/heads/main.zip target=_blank><div><i class='fa-solid fa-download fa-2x'></i><p>Download</p></div></a></div><div class=column><a class=is-itext-link href=https://github.com/um-grex/grex-docs/issues target=_blank><div><i class='fa-solid fa-circle-info fa-2x'></i><p>Report an issue</p></div></a></div><div class=column><a class=is-itext-link href=https://github.com/um-grex/grex-docs/forks target=_blank><div><i class='fa-solid fa-code-branch fa-2x'></i><p>Fork</p></div></a></div></div><p>Website built with <a href=https://gohugo.io/ class=is-pretty-link>Hugo</a> (0.152.0)</p><p>The MIT License (MIT) Copyright © 2025 UM-Grex ()</p></div></div></div></div><div id=navbarShortcuts class="is-hidden modal-container"><div class="modal-content-box modal-text-box"><div class="card modal-title is-radiusless"><div class=card-header><p class="card-header-title is-marginless">Keyboard shortcuts</p></div></div><div class=modal-content-container><div class=modal-content-block><div class=modal-content><kbd>Shift</kbd><p>+</p><kbd>q</kbd></div><div class=modal-content><p class=has-text-weight-normal>Show current page QR code</p></div><div class=modal-content><kbd>Escape</kbd></div><div class=modal-content><p class=has-text-weight-normal>Close modals</p></div><div class=modal-content><kbd>Shift</kbd><p>+</p><kbd>i</kbd></div><div class=modal-content><p class=has-text-weight-normal>Show website information</p></div><div class=modal-content><kbd>Shift</kbd><p>+</p><kbd>k</kbd></div><div class=modal-content><p class=has-text-weight-normal>Show shortcuts</p></div><div class=modal-content><kbd>Shift</kbd><p>+</p><kbd>h</kbd></div><div class=modal-content><p class=has-text-weight-normal>Go to homepage</p></div><div class=modal-content><kbd>Shift</kbd><p>+</p><kbd>f</kbd></div><div class=modal-content><p class=has-text-weight-normal>Find on website</p></div><div class=modal-content><kbd>Shift</kbd><p>+</p><kbd>m</kbd></div><div class=modal-content><p class=has-text-weight-normal>Collapse/Uncollapse sidebar</p></div><div class=modal-content><kbd>Shift</kbd><p>+</p><kbd>t</kbd></div><div class=modal-content><p class=has-text-weight-normal>Collapse/Uncollapse table of contents</p></div><div class=modal-content><kbd>Shift</kbd><p>+</p><kbd>↑</kbd></div><div class=modal-content><p class=has-text-weight-normal>Go to the top of the page</p></div><div class=modal-content><kbd>Shift</kbd><p>+</p><kbd>↓</kbd></div><div class=modal-content><p class=has-text-weight-normal>Go to the bottom of the page</p></div><div class=modal-content><kbd>Shift</kbd><p>+</p><kbd>p</kbd></div><div class=modal-content><p class=has-text-weight-normal>Print current page</p></div></div></div></div></div><div id=modalContainer class="is-hidden modal-container"><div id=modal class=modal-content-box></div></div><nav id=navbar class=navbar role=navigation aria-label="main navigation"><div id=navbarItemsContainer class=navbar-brand><div id=globalLogoContainer class=is-flex><a id=globalLogo class="navbar-item navbar-item-standard is-paddingless" href=/grex-docs/><img alt=Homepage src=/grex-docs/logo/um_logo_email_signature.png>
</a><a id=globalTouchLogo class="navbar-item navbar-item-standard is-paddingless" href=/grex-docs/><img alt=Homepage src=/grex-docs/logo/um_logo_email_signature.png></a></div><div id=navbarItems class=is-flex><div id=navbarItemsStart class=is-flex><div id=searchContainer class=navbar-item><div class="control has-icons-left"><span id=searchInput class=autocomplete><input id=search autocomplete=off class=input type=search placeholder=Search>
</span><span class="icon is-left"><i class="fa-solid fa-magnifying-glass"></i></span><ul id=searchList class="is-paddingless is-hidden"></ul></div></div></div><div id=navbarItemsEnd class="is-flex is-invisible"><div class=navbar-item><a id=printButton class="button navbar-item-standard"><span class=icon-text>Print</span>
<span class=icon><i class="fa-solid fa-print fa-lg"></i></span></a></div><div class=navbar-item><a id=qrCodeButton class="button navbar-item-standard"><span class=icon-text>QR code</span>
<span class=icon><i class="fa-solid fa-qrcode fa-lg"></i></span></a></div><div class=navbar-item><a id=shortcutsInfo trigger=navbarShortcuts class="button navbar-item-standard navbar-trigger" title="Keyboard shortcuts"><span class=icon-text>Shortcuts</span>
<span class=icon><i class="fa-solid fa-keyboard fa-lg"></i></span></a></div><div class=navbar-item><div id=taxonomiesSelectorContainer class="dropdown is-right"><div class=dropdown-trigger><button id=taxonomiesSelector class="button navbar-item-standard" aria-haspopup=true aria-controls=dropdown-menu>
<span class=icon-text>Taxonomies</span>
<span class=icon><i class="fa-solid fa-tags fa-lg"></i></span></button></div><div id=dropdown-menu-taxonomies class=dropdown-menu role=menu><div class="dropdown-content is-paddingless"><a href=/grex-docs/categories/ class="dropdown-item has-text-weight-bold">Categories</a><a href=/grex-docs/tags/ class="dropdown-item has-text-weight-bold">Tags</a></div></div></div></div><div class=navbar-item><a id=siteInfo trigger=navbarInfo class="button navbar-item-standard navbar-trigger" title=About><span class=icon-text>About</span>
<span class=icon><i class="fa-solid fa-circle-question fa-lg"></i></span></a></div><div id=navbarExtend class=navbar-item><div id=navbarExtendWrapper><a id=navbarExtendButton class="button navbar-item-standard"><span class=icon><i class="fa-solid fa-ellipsis fa-lg"></i></span></a><div id=navbarExtendItemsContainer><div id=navbarExtendItemsWrapper><div class=navbar-item><a id=printButtonExtend class="button navbar-item-standard"><span class=icon-text>Print</span>
<span class=icon><i class="fa-solid fa-print fa-lg"></i></span></a></div><div class=navbar-item><a id=qrCodeButtonExtend class="button navbar-item-standard"><span class=icon-text>QR code</span>
<span class=icon><i class="fa-solid fa-qrcode fa-lg"></i></span></a></div><div class=navbar-item><a id=shortcutsInfoExtend trigger=navbarShortcuts class="button navbar-item-standard navbar-trigger" title="Keyboard shortcuts"><span class=icon-text>Shortcuts</span>
<span class=icon><i class="fa-solid fa-keyboard fa-lg"></i></span></a></div><div class=navbar-item><div id=taxonomiesSelectorContainerExtend class="dropdown is-right"><div class=dropdown-trigger><button id=taxonomiesSelectorExtend class="button navbar-item-standard" aria-haspopup=true aria-controls=dropdown-menu>
<span class=icon-text>Taxonomies</span>
<span class=icon><i class="fa-solid fa-tags fa-lg"></i></span></button></div><div id=dropdown-menu-taxonomiesExtend class=dropdown-menu role=menu><div class="dropdown-content is-paddingless"><a href=/grex-docs/categories/ class="dropdown-item has-text-weight-bold">Categories</a><a href=/grex-docs/tags/ class="dropdown-item has-text-weight-bold">Tags</a></div></div></div></div><div class=navbar-item><a id=siteInfoExtend trigger=navbarInfo class="button navbar-item-standard navbar-trigger" title=About><span class=icon-text>About</span>
<span class=icon><i class="fa-solid fa-circle-question fa-lg"></i></span></a></div></div></div></div></div></div></div></div></nav><div id=navbarOverlay></div><div class="columns is-mobile is-paddingless is-marginless" id=mainContainer><div id=sidebarContainer class="column is-narrow is-paddingless is-marginless"><div id=sidebarWrapper class=is-fixed><div id=sidebar class=is-marginless><aside class="menu is-paddingless is-marginless"><ul class="menu-list is-marginless is-paddingless"><div class="card is-fs-expandable-icon"><div class="card-header is-single-link"><a href=/grex-docs/grex/ class=card-header-title><i class='fa-solid fa-microchip fa-lg'></i></a></div></div><div class=is-expandable><div class=is-sidebar-list-wrapper><li class=is-marginless><div class=card><div class="card-header is-single-link"><a href=/grex-docs/grex/ class=card-header-title title=Grex><i class='fa-solid fa-microchip fa-lg'></i><p class="pt-0 pb-0 pr-2 pl-1">Grex</p></a></div></div></li></div></div><div class="card is-fs-expandable-icon"><div class="card-header is-single-link"><a href=/grex-docs/start-guide/ class=card-header-title><i class='fa-solid fa-bolt-lightning fa-lg'></i></a></div></div><div class=is-expandable><div class=is-sidebar-list-wrapper><li class=is-marginless><div class=card><div class="card-header is-single-link"><a href=/grex-docs/start-guide/ class=card-header-title title='Quick Start Guide'><i class='fa-solid fa-bolt-lightning fa-lg'></i><p class="pt-0 pb-0 pr-2 pl-1">Quick Start Guide</p></a></div></div></li></div></div><div class="card is-fs-expandable-icon"><div class="card-header is-single-link"><a href=/grex-docs/access/ class=card-header-title><i class='fa-solid fa-id-card fa-lg'></i></a></div></div><div class=is-expandable><div class=is-sidebar-list-wrapper><li class=is-marginless><div class=card><div class="card-header is-single-link"><a href=/grex-docs/access/ class=card-header-title title='Access and usage conditions'><i class='fa-solid fa-id-card fa-lg'></i><p class="pt-0 pb-0 pr-2 pl-1">Access and usage conditions</p></a></div></div></li></div></div><div class="card is-fs-expandable-icon"><div class=card-header><a href=/grex-docs/connecting/ class=card-header-title><i class='fa-solid fa-plug fa-lg'></i></a></div></div><div class=is-expandable><div class=is-sidebar-list-wrapper><li class="is-marginless is-entries-expandable is-entries-shrinked"><div class=card><div class=card-header><a href=/grex-docs/connecting/ class=card-header-title title='Connecting to Grex'><i class='fa-solid fa-plug fa-lg'></i><p class="pt-0 pb-0 pr-2 pl-1">Connecting to Grex</p></a><a class="card-header-icon is-icon-expandable is-paddingless is-icon-shrinked"><span class=icon></span></a></div></div><ul class=is-marginless><div><div><li class=is-marginless><div class=card><div class="card-header is-single-link"><a href=/grex-docs/connecting/mfa/ class=card-header-title title='Multi-Factor Authentication'><i class='fa-solid fa-turn-up fa-rotate-90 fa-xs'></i><p class="pt-0 pb-0 pr-2 pl-0">Multi-Factor Authentication</p></a></div></div></li></div></div><div><div><li class=is-marginless><div class=card><div class="card-header is-single-link"><a href=/grex-docs/connecting/ssh/ class=card-header-title title='Connecting with SSH'><i class='fa-solid fa-turn-up fa-rotate-90 fa-xs'></i><p class="pt-0 pb-0 pr-2 pl-0">Connecting with SSH</p></a></div></div></li></div></div><div><div><li class=is-marginless><div class=card><div class="card-header is-single-link"><a href=/grex-docs/connecting/ood/ class=card-header-title title='Connect with OOD'><i class='fa-solid fa-turn-up fa-rotate-90 fa-xs'></i><p class="pt-0 pb-0 pr-2 pl-0">Connect with OOD</p></a></div></div></li></div></div></ul></li></div></div><div class="card is-fs-expandable-icon"><div class=card-header><a href=/grex-docs/data-transfer/ class=card-header-title><i class='fa-solid fa-arrow-right-arrow-left fa-lg'></i></a></div></div><div class=is-expandable><div class=is-sidebar-list-wrapper><li class="is-marginless is-entries-expandable is-entries-shrinked"><div class=card><div class=card-header><a href=/grex-docs/data-transfer/ class=card-header-title title='Transferring Data'><i class='fa-solid fa-arrow-right-arrow-left fa-lg'></i><p class="pt-0 pb-0 pr-2 pl-1">Transferring Data</p></a><a class="card-header-icon is-icon-expandable is-paddingless is-icon-shrinked"><span class=icon></span></a></div></div><ul class=is-marginless><div><div><li class=is-marginless><div class=card><div class="card-header is-single-link"><a href=/grex-docs/data-transfer/globus/ class=card-header-title title='Globus on Grex '><i class='fa-solid fa-turn-up fa-rotate-90 fa-xs'></i><p class="pt-0 pb-0 pr-2 pl-0">Globus on Grex</p></a></div></div></li></div></div><div><div><li class=is-marginless><div class=card><div class="card-header is-single-link"><a href=/grex-docs/data-transfer/one-drive/ class=card-header-title title='Rclone and OneDrive'><i class='fa-solid fa-turn-up fa-rotate-90 fa-xs'></i><p class="pt-0 pb-0 pr-2 pl-0">Rclone and OneDrive</p></a></div></div></li></div></div><div><div><li class=is-marginless><div class=card><div class="card-header is-single-link"><a href=/grex-docs/data-transfer/object-storage/ class=card-header-title title='Object Storage on OpenStack'><i class='fa-solid fa-turn-up fa-rotate-90 fa-xs'></i><p class="pt-0 pb-0 pr-2 pl-0">Object Storage on OpenStack</p></a></div></div></li></div></div></ul></li></div></div><div class="card is-fs-expandable-icon"><div class=card-header><a href=/grex-docs/storage/ class=card-header-title><i class='fa-solid fa-database fa-lg'></i></a></div></div><div class=is-expandable><div class=is-sidebar-list-wrapper><li class="is-marginless is-entries-expandable is-entries-shrinked"><div class=card><div class=card-header><a href=/grex-docs/storage/ class=card-header-title title='Storage and Data'><i class='fa-solid fa-database fa-lg'></i><p class="pt-0 pb-0 pr-2 pl-1">Storage and Data</p></a><a class="card-header-icon is-icon-expandable is-paddingless is-icon-shrinked"><span class=icon></span></a></div></div><ul class=is-marginless><div><div><li class=is-marginless><div class=card><div class="card-header is-single-link"><a href=/grex-docs/storage/data-sizes-and-quota/ class=card-header-title title='Data sizes and Quotas'><i class='fa-solid fa-turn-up fa-rotate-90 fa-xs'></i><p class="pt-0 pb-0 pr-2 pl-0">Data sizes and Quotas</p></a></div></div></li></div></div><div><div><li class=is-marginless><div class=card><div class="card-header is-single-link"><a href=/grex-docs/storage/data-backup/ class=card-header-title title='Data Backup'><i class='fa-solid fa-turn-up fa-rotate-90 fa-xs'></i><p class="pt-0 pb-0 pr-2 pl-0">Data Backup</p></a></div></div></li></div></div><div><div><li class=is-marginless><div class=card><div class="card-header is-single-link"><a href=/grex-docs/storage/data-sharing/ class=card-header-title title='Data sharing'><i class='fa-solid fa-turn-up fa-rotate-90 fa-xs'></i><p class="pt-0 pb-0 pr-2 pl-0">Data sharing</p></a></div></div></li></div></div></ul></li></div></div><div class="card is-fs-expandable-icon"><div class=card-header><a href=/grex-docs/running-jobs/ class=card-header-title><i class='fa-solid fa-person-running fa-lg'></i></a></div></div><div class=is-expandable><div class=is-sidebar-list-wrapper><li class="is-marginless is-entries-expandable is-entries-shrinked"><div class=card><div class=card-header><a href=/grex-docs/running-jobs/ class=card-header-title title='Running Jobs'><i class='fa-solid fa-person-running fa-lg'></i><p class="pt-0 pb-0 pr-2 pl-1">Running Jobs</p></a><a class="card-header-icon is-icon-expandable is-paddingless is-icon-shrinked"><span class=icon></span></a></div></div><ul class=is-marginless><div><div><li class=is-marginless><div class=card><div class="card-header is-single-link"><a href=/grex-docs/running-jobs/slurm-partitions/ class=card-header-title title='Slurm partitions'><i class='fa-solid fa-turn-up fa-rotate-90 fa-xs'></i><p class="pt-0 pb-0 pr-2 pl-0">Slurm partitions</p></a></div></div></li></div></div><div><div><li class=is-marginless><div class=card><div class="card-header is-single-link"><a href=/grex-docs/running-jobs/interactive-jobs/ class=card-header-title title='Interactive jobs'><i class='fa-solid fa-turn-up fa-rotate-90 fa-xs'></i><p class="pt-0 pb-0 pr-2 pl-0">Interactive jobs</p></a></div></div></li></div></div><div><div><li class=is-marginless><div class=card><div class="card-header is-single-link"><a href=/grex-docs/running-jobs/batch-jobs/ class=card-header-title title='Batch jobs'><i class='fa-solid fa-turn-up fa-rotate-90 fa-xs'></i><p class="pt-0 pb-0 pr-2 pl-0">Batch jobs</p></a></div></div></li></div></div><div><div><li class=is-marginless><div class=card><div class="card-header is-single-link"><a href=/grex-docs/running-jobs/contributed-systems/ class=card-header-title title='Contributed nodes'><i class='fa-solid fa-turn-up fa-rotate-90 fa-xs'></i><p class="pt-0 pb-0 pr-2 pl-0">Contributed nodes</p></a></div></div></li></div></div><div><div><li class=is-marginless><div class=card><div class="card-header is-single-link"><a href=/grex-docs/running-jobs/using-localdisks/ class=card-header-title title='Using local disks'><i class='fa-solid fa-turn-up fa-rotate-90 fa-xs'></i><p class="pt-0 pb-0 pr-2 pl-0">Using local disks</p></a></div></div></li></div></div></ul></li></div></div><div class="card is-fs-expandable-icon"><div class=card-header><a href=/grex-docs/software/ class=card-header-title><i class='fa-solid fa-terminal fa-lg'></i></a></div></div><div class=is-expandable><div class=is-sidebar-list-wrapper><li class="is-marginless is-entries-expandable is-entries-shrinked"><div class=card><div class=card-header><a href=/grex-docs/software/ class=card-header-title title='Software / Applications'><i class='fa-solid fa-terminal fa-lg'></i><p class="pt-0 pb-0 pr-2 pl-1">Software / Applications</p></a><a class="card-header-icon is-icon-expandable is-paddingless is-icon-shrinked"><span class=icon></span></a></div></div><ul class=is-marginless><div><div><li class=is-marginless><div class=card><div class="card-header is-single-link"><a href=/grex-docs/software/general-linux/ class=card-header-title title='Linux tools'><i class='fa-solid fa-turn-up fa-rotate-90 fa-xs'></i><p class="pt-0 pb-0 pr-2 pl-0">Linux tools</p></a></div></div></li></div></div><div><div><li class=is-marginless><div class=card><div class="card-header is-single-link"><a href=/grex-docs/software/using-modules/ class=card-header-title title='Using modules'><i class='fa-solid fa-turn-up fa-rotate-90 fa-xs'></i><p class="pt-0 pb-0 pr-2 pl-0">Using modules</p></a></div></div></li></div></div><div><div><li class=is-marginless><div class=card><div class="card-header is-single-link"><a href=/grex-docs/software/code-development/ class=card-header-title title='Code development'><i class='fa-solid fa-turn-up fa-rotate-90 fa-xs'></i><p class="pt-0 pb-0 pr-2 pl-0">Code development</p></a></div></div></li></div></div><div><div><li class=is-marginless><div class=card><div class="card-header is-single-link"><a href=/grex-docs/software/containers/ class=card-header-title title=Containers><i class='fa-solid fa-turn-up fa-rotate-90 fa-xs'></i><p class="pt-0 pb-0 pr-2 pl-0">Containers</p></a></div></div></li></div></div><div><div><li class=is-marginless><div class=card><div class="card-header is-single-link"><a href=/grex-docs/software/cern-vmfs/ class=card-header-title title=CVMFS><i class='fa-solid fa-turn-up fa-rotate-90 fa-xs'></i><p class="pt-0 pb-0 pr-2 pl-0">CVMFS</p></a></div></div></li></div></div><div><div><li class=is-marginless><div class=card><div class="card-header is-single-link"><a href=/grex-docs/software/software-list/ class=card-header-title title='List of Software'><i class='fa-solid fa-turn-up fa-rotate-90 fa-xs'></i><p class="pt-0 pb-0 pr-2 pl-0">List of Software</p></a></div></div></li></div></div></ul></li></div></div><div class="card is-fs-expandable-icon is-sidebar-active"><div class=card-header><a href=/grex-docs/specific-soft/ class=card-header-title><i class='fa-solid fa-glasses fa-lg'></i></a></div></div><div class=is-expandable><div class=is-sidebar-list-wrapper><li class="is-marginless is-tree-active is-entries-expandable is-entries-expanded"><div class=card><div class=card-header><a href=/grex-docs/specific-soft/ class=card-header-title title='Software Specific Notes'><i class='fa-solid fa-glasses fa-lg'></i><p class="pt-0 pb-0 pr-2 pl-1">Software Specific Notes</p></a><a class="card-header-icon is-icon-expandable is-paddingless is-icon-expanded"><span class=icon></span></a></div></div><ul class="is-marginless is-tree-active"><div><div><li class=is-marginless><div class=card><div class="card-header is-single-link"><a href=/grex-docs/specific-soft/espresso/ class=card-header-title title=Espresso><i class='fa-solid fa-turn-up fa-rotate-90 fa-xs'></i><p class="pt-0 pb-0 pr-2 pl-0">Espresso</p></a></div></div></li></div></div><div><div><li class=is-marginless><div class=card><div class="card-header is-single-link"><a href=/grex-docs/specific-soft/gaussian/ class=card-header-title title=Gaussian><i class='fa-solid fa-turn-up fa-rotate-90 fa-xs'></i><p class="pt-0 pb-0 pr-2 pl-0">Gaussian</p></a></div></div></li></div></div><div><div><li class=is-marginless><div class=card><div class="card-header is-single-link"><a href=/grex-docs/specific-soft/gromacs/ class=card-header-title title=GROMACS><i class='fa-solid fa-turn-up fa-rotate-90 fa-xs'></i><p class="pt-0 pb-0 pr-2 pl-0">GROMACS</p></a></div></div></li></div></div><div><div><li class=is-marginless><div class=card><div class="card-header is-single-link"><a href=/grex-docs/specific-soft/julia/ class=card-header-title title=Julia><i class='fa-solid fa-turn-up fa-rotate-90 fa-xs'></i><p class="pt-0 pb-0 pr-2 pl-0">Julia</p></a></div></div></li></div></div><div><div><li class=is-marginless><div class=card><div class="card-header is-single-link"><a href=/grex-docs/specific-soft/jupyter-notebook/ class=card-header-title title='Jupyter notebooks'><i class='fa-solid fa-turn-up fa-rotate-90 fa-xs'></i><p class="pt-0 pb-0 pr-2 pl-0">Jupyter notebooks</p></a></div></div></li></div></div><div><div><li class=is-marginless><div class=card><div class="card-header is-single-link"><a href=/grex-docs/specific-soft/lammps/ class=card-header-title title=LAMMPS><i class='fa-solid fa-turn-up fa-rotate-90 fa-xs'></i><p class="pt-0 pb-0 pr-2 pl-0">LAMMPS</p></a></div></div></li></div></div><div><div><li class=is-marginless><div class=card><div class="card-header is-single-link"><a href=/grex-docs/specific-soft/matlab/ class=card-header-title title=MATLAB><i class='fa-solid fa-turn-up fa-rotate-90 fa-xs'></i><p class="pt-0 pb-0 pr-2 pl-0">MATLAB</p></a></div></div></li></div></div><div><div><li class=is-marginless><div class=card><div class="card-header is-single-link"><a href=/grex-docs/specific-soft/nwchem/ class=card-header-title title=NWChem><i class='fa-solid fa-turn-up fa-rotate-90 fa-xs'></i><p class="pt-0 pb-0 pr-2 pl-0">NWChem</p></a></div></div></li></div></div><div><div><li class=is-marginless><div class=card><div class="card-header is-single-link"><a href=/grex-docs/specific-soft/orca/ class=card-header-title title=ORCA><i class='fa-solid fa-turn-up fa-rotate-90 fa-xs'></i><p class="pt-0 pb-0 pr-2 pl-0">ORCA</p></a></div></div></li></div></div><div><div><li class=is-marginless><div class=card><div class="card-header is-single-link"><a href=/grex-docs/specific-soft/r-program/ class=card-header-title title=R><i class='fa-solid fa-turn-up fa-rotate-90 fa-xs'></i><p class="pt-0 pb-0 pr-2 pl-0">R</p></a></div></div></li></div></div><div><div><li class=is-marginless><div class=card><div class="card-header is-single-link"><a href=/grex-docs/specific-soft/vasp/ class=card-header-title title=VASP><i class='fa-solid fa-turn-up fa-rotate-90 fa-xs'></i><p class="pt-0 pb-0 pr-2 pl-0">VASP</p></a></div></div></li></div></div><div><div><li class=is-marginless><div class="card is-sidebar-active" id=sidebarActiveEntry><div class="card-header is-single-link"><a href=/grex-docs/specific-soft/python-ai/ class=card-header-title title='Python for ML'><i class='fa-solid fa-turn-up fa-rotate-90 fa-xs'></i><p class="pt-0 pb-0 pr-2 pl-0">Python for ML</p></a></div></div></li></div></div></ul></li></div></div><div class="card is-fs-expandable-icon"><div class=card-header><a href=/grex-docs/ood/ class=card-header-title><i class='fa-solid fa-cloud fa-lg'></i></a></div></div><div class=is-expandable><div class=is-sidebar-list-wrapper><li class="is-marginless is-entries-expandable is-entries-shrinked"><div class=card><div class=card-header><a href=/grex-docs/ood/ class=card-header-title title=OpenOnDemand><i class='fa-solid fa-cloud fa-lg'></i><p class="pt-0 pb-0 pr-2 pl-1">OpenOnDemand</p></a><a class="card-header-icon is-icon-expandable is-paddingless is-icon-shrinked"><span class=icon></span></a></div></div><ul class=is-marginless><div><div><li class=is-marginless><div class=card><div class="card-header is-single-link"><a href=/grex-docs/ood/desktops/ class=card-header-title title=Desktops><i class='fa-solid fa-turn-up fa-rotate-90 fa-xs'></i><p class="pt-0 pb-0 pr-2 pl-0">Desktops</p></a></div></div></li></div></div><div><div><li class=is-marginless><div class=card><div class="card-header is-single-link"><a href=/grex-docs/ood/interactive-apps/ class=card-header-title title='Custom Apps'><i class='fa-solid fa-turn-up fa-rotate-90 fa-xs'></i><p class="pt-0 pb-0 pr-2 pl-0">Custom Apps</p></a></div></div></li></div></div><div><div><li class=is-marginless><div class=card><div class="card-header is-single-link"><a href=/grex-docs/ood/servers/ class=card-header-title title=Servers><i class='fa-solid fa-turn-up fa-rotate-90 fa-xs'></i><p class="pt-0 pb-0 pr-2 pl-0">Servers</p></a></div></div></li></div></div><div><div><li class=is-marginless><div class=card><div class="card-header is-single-link"><a href=/grex-docs/ood/job-composer/ class=card-header-title title='Job Composer'><i class='fa-solid fa-turn-up fa-rotate-90 fa-xs'></i><p class="pt-0 pb-0 pr-2 pl-0">Job Composer</p></a></div></div></li></div></div><div><div><li class=is-marginless><div class=card><div class="card-header is-single-link"><a href=/grex-docs/ood/guide-lines/ class=card-header-title title='Guide Lines'><i class='fa-solid fa-turn-up fa-rotate-90 fa-xs'></i><p class="pt-0 pb-0 pr-2 pl-0">Guide Lines</p></a></div></div></li></div></div></ul></li></div></div><div class="card is-fs-expandable-icon"><div class=card-header><a href=/grex-docs/training/ class=card-header-title><i class='fa-solid fa-chalkboard-user fa-lg'></i></a></div></div><div class=is-expandable><div class=is-sidebar-list-wrapper><li class="is-marginless is-entries-expandable is-entries-shrinked"><div class=card><div class=card-header><a href=/grex-docs/training/ class=card-header-title title=Workshops><i class='fa-solid fa-chalkboard-user fa-lg'></i><p class="pt-0 pb-0 pr-2 pl-1">Workshops</p></a><a class="card-header-icon is-icon-expandable is-paddingless is-icon-shrinked"><span class=icon></span></a></div></div><ul class=is-marginless><div><div><li class="is-marginless is-entries-expandable is-entries-shrinked"><div class=card><div class=card-header><a href=/grex-docs/training/workshops-2025/ class=card-header-title title=2025><i class='fa-solid fa-turn-up fa-rotate-90 fa-xs'></i><p class="pt-0 pb-0 pr-2 pl-0">2025</p></a><a class="card-header-icon is-icon-expandable is-paddingless is-icon-shrinked"><span class=icon></span></a></div></div><ul class=is-marginless><div><div><li class=is-marginless><div class=card><div class="card-header is-single-link"><a href=/grex-docs/training/workshops-2025/lora-huggingface/ class=card-header-title title='LoRa walkthrough'><i class='fa-solid fa-turn-up fa-rotate-90 fa-xs'></i><p class="pt-0 pb-0 pr-2 pl-0">LoRa walkthrough</p></a></div></div></li></div></div></ul></li></div></div><div><div><li class=is-marginless><div class=card><div class="card-header is-single-link"><a href=/grex-docs/training/workshops-2024/ class=card-header-title title=2024><i class='fa-solid fa-turn-up fa-rotate-90 fa-xs'></i><p class="pt-0 pb-0 pr-2 pl-0">2024</p></a></div></div></li></div></div><div><div><li class=is-marginless><div class=card><div class="card-header is-single-link"><a href=/grex-docs/training/workshops-2023/ class=card-header-title title=2023><i class='fa-solid fa-turn-up fa-rotate-90 fa-xs'></i><p class="pt-0 pb-0 pr-2 pl-0">2023</p></a></div></div></li></div></div><div><div><li class=is-marginless><div class=card><div class="card-header is-single-link"><a href=/grex-docs/training/workshops-2022/ class=card-header-title title=2022><i class='fa-solid fa-turn-up fa-rotate-90 fa-xs'></i><p class="pt-0 pb-0 pr-2 pl-0">2022</p></a></div></div></li></div></div><div><div><li class=is-marginless><div class=card><div class="card-header is-single-link"><a href=/grex-docs/training/workshops-2021/ class=card-header-title title=2021><i class='fa-solid fa-turn-up fa-rotate-90 fa-xs'></i><p class="pt-0 pb-0 pr-2 pl-0">2021</p></a></div></div></li></div></div></ul></li></div></div><div class="card is-fs-expandable-icon"><div class=card-header><a href=/grex-docs/friends/ class=card-header-title><i class='fa-solid fa-users fa-lg'></i></a></div></div><div class=is-expandable><div class=is-sidebar-list-wrapper><li class="is-marginless is-entries-expandable is-entries-shrinked"><div class=card><div class=card-header><a href=/grex-docs/friends/ class=card-header-title title='Friendly Organizations'><i class='fa-solid fa-users fa-lg'></i><p class="pt-0 pb-0 pr-2 pl-1">Friendly Organizations</p></a><a class="card-header-icon is-icon-expandable is-paddingless is-icon-shrinked"><span class=icon></span></a></div></div><ul class=is-marginless><div><div><li class=is-marginless><div class=card><div class="card-header is-single-link"><a href=/grex-docs/friends/alliancecan/ class=card-header-title title='DRAC (Alliance)'><i class='fa-solid fa-turn-up fa-rotate-90 fa-xs'></i><p class="pt-0 pb-0 pr-2 pl-0">DRAC (Alliance)</p></a></div></div></li></div></div><div><div><li class=is-marginless><div class=card><div class="card-header is-single-link"><a href=/grex-docs/friends/localit/ class=card-header-title title='UManitoba IT resources'><i class='fa-solid fa-turn-up fa-rotate-90 fa-xs'></i><p class="pt-0 pb-0 pr-2 pl-0">UManitoba IT resources</p></a></div></div></li></div></div></ul></li></div></div><div class="card is-fs-expandable-icon"><div class="card-header is-single-link"><a href=/grex-docs/support/ class=card-header-title><i class='fa-solid fa-circle-info fa-lg'></i></a></div></div><div class=is-expandable><div class=is-sidebar-list-wrapper><li class=is-marginless><div class=card><div class="card-header is-single-link"><a href=/grex-docs/support/ class=card-header-title title='Getting Help'><i class='fa-solid fa-circle-info fa-lg'></i><p class="pt-0 pb-0 pr-2 pl-1">Getting Help</p></a></div></div></li></div></div><div class="card is-fs-expandable-icon"><div class="card-header is-single-link"><a href=/grex-docs/disclaimer/ class=card-header-title><i class='fa-solid fa-triangle-exclamation fa-lg'></i></a></div></div><div class=is-expandable><div class=is-sidebar-list-wrapper><li class=is-marginless><div class=card><div class="card-header is-single-link"><a href=/grex-docs/disclaimer/ class=card-header-title title=Disclaimer><i class='fa-solid fa-triangle-exclamation fa-lg'></i><p class="pt-0 pb-0 pr-2 pl-1">Disclaimer</p></a></div></div></li></div></div><div class="card is-fs-expandable-icon"><div class="card-header is-single-link"><a href=/grex-docs/glossary/ class=card-header-title><i class='fa-solid fa-book-atlas fa-lg'></i></a></div></div><div class=is-expandable><div class=is-sidebar-list-wrapper><li class=is-marginless><div class=card><div class="card-header is-single-link"><a href=/grex-docs/glossary/ class=card-header-title title=Glossary><i class='fa-solid fa-book-atlas fa-lg'></i><p class="pt-0 pb-0 pr-2 pl-1">Glossary</p></a></div></div></li></div></div><div class="card is-fs-expandable-icon"><div class="card-header is-single-link"><a href=/grex-docs/sitemap/ class=card-header-title><i class='fa-solid fa-sitemap fa-lg'></i></a></div></div><div class=is-expandable><div class=is-sidebar-list-wrapper><li class=is-marginless><div class=card><div class="card-header is-single-link"><a href=/grex-docs/sitemap/ class=card-header-title title=Sitemap><i class='fa-solid fa-sitemap fa-lg'></i><p class="pt-0 pb-0 pr-2 pl-1">Sitemap</p></a></div></div></li></div></div></ul></aside></div><div id=sidebarCollapsible class=is-marginless><div class="card is-uncollapse-action"><div id=sidebarUncollapse class="card-header is-single-link" title="Collapse/Uncollapse sidebar"><a class=card-header-title><i class="fa-solid fa-angles-right fa-lg"></i></a></div></div><div class="card is-collapse-action"><div id=sidebarCollapse class="card-header is-single-link" title="Collapse/Uncollapse sidebar"><a class=card-header-title><i class="fa-solid fa-angles-left fa-lg"></i><p>Collapse sidebar</p></a></div></div></div></div></div><div id=sidebarMobileWrapper class="column is-narrow is-hidden-desktop"></div><div class="columns is-mobile is-marginless is-scroll-smooth has-toc" id=contentContainer><div class=column id=content><div class=banner><i class="fa-solid fa-circle-exclamation fa-2x"></i>
<span><strong>Work in progress.</strong></span>
<i class="fa-solid fa-circle-exclamation fa-2x"></i></div><div id=contentTitle>Using Python for ML on Grex</div><h2 id=introduction>Introduction<a href=#introduction class=anchor>#</a></h2><hr><p>Python is a dynamic language with many optional Library &ldquo;modules&rdquo; available. Moreover, Python is often used as a &ldquo;glue&rdquo; language for interacting with tools and libraries written in other languages (C/C++, Fortran, CUDA, etc.).
This makes maintenance of Python software difficult. Not only do Python and libraries need to be of the right versions, but also other software they depend on should be of the same versions that have been used to build the corresponding packages.</p><p>Some of the mechanisms to handle these dependency problems are:</p><ul><li><em>conda</em> (including everything, most of Linux with all the software binaries in Python repo).</li><li><em>virtualenv</em> / <em>pip</em>.</li><li>packaging Python modules as HPC software Modules.</li><li>using Linux containers like Docker or Singularity with all the software packed up by the software developers.</li></ul><p>The <em>conda</em> offers an easy way to package up all dependencies and often is liked by the users. Many <em>conda</em> repositories exist. Sometimes <em>conda</em> is the only way to run a particularly badly maintained Python package.
However, it has important drawbacks such as packaging up all the dependencies which uses a lot of disk space, and provide for conflicts with HPC and Linux environments. Thus, <em>conda</em> can be used on HPC machines like Grex at the user&rsquo;s risk.
In particular, we suggest against any automatic &ldquo;activation&rdquo; of <em>conda</em> environments in users&rsquo; startup scripts (like <em>~/.bashrc</em>).</p><div class="sc-alert sc-alert-warning">Note that as of 2024, Anaconda owners strictened their licensing policy. We do not provide any system-wide <em>conda</em> installations on Grex. In case users want to continue using <em>conda</em>, they must be sure that they have a proper Anaconda license to do so. Note also that the same applies for <em>mamba</em> which would use the same conda software channels.</div><p>The <em>virtualenv</em>, while similar to <em>conda</em> in that it would isolate the Python dependencies, is more HPC-friendly because it allows for using HPC modules together with Python <em>pip</em> to control dependencies per particular software item. ComputeCanada / The Alliance has chosen to provide for the CCEnv just basic Python as a Module, and let users use <em>virtualenv</em> for each workflow they would like.
ComputeCanada / The Alliance provides repackaged Python &ldquo;wheels&rdquo; to work properly with CCEnv. <em>pip install</em> from CCEnv would use these wheels first. Using _&ndash;index-url _ that would point to other sources of the &ldquo;wheels&rdquo; can lead to problems and broken installations.</p><p>Adding each and every package with pip is time-consuming. CCEnv provides &ldquo;modules&rdquo; for a most common combination of fixed module versions of NumPy, SciPy, Matplotlib, etc., so-called <em>scipy-stack</em> modules.</p><h2 id=examples-of-use-cases>Examples of Use Cases<a href=#examples-of-use-cases class=anchor>#</a></h2><hr><h3 id=example-1-using-openai-shape-e-in-ccenv-virtualenv>Example 1: using OpenAI shape-e in CCEnv virtualenv<a href=#example-1-using-openai-shape-e-in-ccenv-virtualenv class=anchor>#</a></h3><p>Let us put the above into practice, by using an old OpenAI ML model, <a href=https://github.com/openai/shap-e class=is-pretty-link>shap-e</a>
that can generate 3D objects in the form of <em>.ply</em> meshes, from a text.
The example below will use the Alliance software environment, <em>virtualenv</em>, and the &ldquo;shap-e&rdquo; model fetched from GitHub.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Lets get an interactive job on a GPU node using 1 GPU for 2 hours</span>
</span></span><span style=display:flex><span>salloc --gpus<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> --partition<span style=color:#f92672>=</span>stamps-b,agro-b,mcordcpu-b --cpus-per-task<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span> --mem<span style=color:#f92672>=</span>32gb --time<span style=color:#f92672>=</span>0-2:00</span></span></code></pre></div><blockquote><p>Note the prompt changed to user@gXYZ; you should be on a compute node with GPU now. You can try <em>nvidia-smi</em> command to see the GPU model, driver version etc.</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Let&#39;s switch to CCEnv 2023 enviroment  by loading required modules!</span>
</span></span><span style=display:flex><span>module load CCEnv
</span></span><span style=display:flex><span>module load arch/avx512 StdEnv/2023
</span></span><span style=display:flex><span><span style=color:#75715e># Let&#39;s load CUDA, cuDNN, python  and Scipy stack modules needed to run the model. </span>
</span></span><span style=display:flex><span><span style=color:#75715e>#The module versions are current as of Jul 2024</span>
</span></span><span style=display:flex><span>module load cuda/12.2 cudnn/9.2.1.18
</span></span><span style=display:flex><span>module load python/3.11.5 scipy-stack/2024a 
</span></span><span style=display:flex><span>which python</span></span></code></pre></div><p>We now have a <em>python</em> executable in the PATH, ready to set up a <em>virtualenv</em> with all the dependencies required by &ldquo;shap-e&rdquo;. These are Torch, Torchaudio, Torchvision, and PyTorch3d.
It is often a challenge to provide matching versions for these ML libraries, so some trial and error with the &ldquo;wheels&rdquo; of the same or close enough versions available on CCEnv is usually required.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Lets start a virtualenv called shapee</span>
</span></span><span style=display:flex><span>virtualenv shapee
</span></span><span style=display:flex><span>source shapee/bin/activate</span></span></code></pre></div><blockquote><p>Note the prompt changes again to something like &ldquo;(shapee) [user@gXYZ]&rdquo;. We are now in a new Python environment and can proceed with installing Python dependencies and the ML model using pip.</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># These versions work in 2024</span>
</span></span><span style=display:flex><span>pip install jupyter nbconvert jupyter_contrib_nbextensions
</span></span><span style=display:flex><span>pip install torchvision<span style=color:#f92672>==</span>0.16.2 torchaudio<span style=color:#f92672>==</span>2.1.1 pytorch3d<span style=color:#f92672>==</span>0.7.5
</span></span><span style=display:flex><span>git clone https://github.com/openai/shap-e <span style=color:#f92672>&amp;&amp;</span> cd shap-e <span style=color:#f92672>&amp;&amp;</span> pip install -e .
</span></span><span style=display:flex><span>cd ..</span></span></code></pre></div><p>If the above commands had passed without the errors, we should be able to use the model. A standalone example (made from the Jupyter notebook provided in the GitHub repo) should be able to run with Python in this _virtualenv and generate the <em>.ply</em> mesh files.</p><div class=sc-collapsible-container><div class=sc-collapsible-header>Python script example for shap-e</div><div class=sc-collapsible-content><div class=sc-snippet-wrapper><div class=sc-snippet-container><div class=sc-snippet><div class=sc-snippet-caption>shap-e-test.py</div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># https://github.com/openai/shap-e/blob/main/shap_e/examples/sample_text_to_3d.ipynb converted to Python</span>
</span></span><span style=display:flex><span><span style=color:#75715e># </span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> torch
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> shap_e.diffusion.sample <span style=color:#f92672>import</span> sample_latents
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> shap_e.diffusion.gaussian_diffusion <span style=color:#f92672>import</span> diffusion_from_config
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> shap_e.models.download <span style=color:#f92672>import</span> load_model, load_config
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> shap_e.util.notebooks <span style=color:#f92672>import</span> create_pan_cameras, decode_latent_images, gif_widget
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>device <span style=color:#f92672>=</span> torch<span style=color:#f92672>.</span>device(<span style=color:#e6db74>&#39;cuda&#39;</span> <span style=color:#66d9ef>if</span> torch<span style=color:#f92672>.</span>cuda<span style=color:#f92672>.</span>is_available() <span style=color:#66d9ef>else</span> <span style=color:#e6db74>&#39;cpu&#39;</span>)
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#34;found device </span><span style=color:#e6db74>%s</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>%</span> device)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>xm <span style=color:#f92672>=</span> load_model(<span style=color:#e6db74>&#39;transmitter&#39;</span>, device<span style=color:#f92672>=</span>device)
</span></span><span style=display:flex><span>model <span style=color:#f92672>=</span> load_model(<span style=color:#e6db74>&#39;text300M&#39;</span>, device<span style=color:#f92672>=</span>device)
</span></span><span style=display:flex><span>diffusion <span style=color:#f92672>=</span> diffusion_from_config(load_config(<span style=color:#e6db74>&#39;diffusion&#39;</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>batch_size <span style=color:#f92672>=</span> <span style=color:#ae81ff>4</span>
</span></span><span style=display:flex><span>guidance_scale <span style=color:#f92672>=</span> <span style=color:#ae81ff>15.0</span>
</span></span><span style=display:flex><span>prompt <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;a shark&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>latents <span style=color:#f92672>=</span> sample_latents(
</span></span><span style=display:flex><span>    batch_size<span style=color:#f92672>=</span>batch_size,
</span></span><span style=display:flex><span>    model<span style=color:#f92672>=</span>model,
</span></span><span style=display:flex><span>    diffusion<span style=color:#f92672>=</span>diffusion,
</span></span><span style=display:flex><span>    guidance_scale<span style=color:#f92672>=</span>guidance_scale,
</span></span><span style=display:flex><span>    model_kwargs<span style=color:#f92672>=</span>dict(texts<span style=color:#f92672>=</span>[prompt] <span style=color:#f92672>*</span> batch_size),
</span></span><span style=display:flex><span>    progress<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>,
</span></span><span style=display:flex><span>    clip_denoised<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>,
</span></span><span style=display:flex><span>    use_fp16<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>,
</span></span><span style=display:flex><span>    use_karras<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>,
</span></span><span style=display:flex><span>    karras_steps<span style=color:#f92672>=</span><span style=color:#ae81ff>64</span>,
</span></span><span style=display:flex><span>    sigma_min<span style=color:#f92672>=</span><span style=color:#ae81ff>1e-3</span>,
</span></span><span style=display:flex><span>    sigma_max<span style=color:#f92672>=</span><span style=color:#ae81ff>160</span>,
</span></span><span style=display:flex><span>    s_churn<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>,
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Interactive display skipped, lets generate mesh files</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Example of saving the latents as meshes.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> shap_e.util.notebooks <span style=color:#f92672>import</span> decode_latent_mesh
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> i, latent <span style=color:#f92672>in</span> enumerate(latents):
</span></span><span style=display:flex><span>    t <span style=color:#f92672>=</span> decode_latent_mesh(xm, latent)<span style=color:#f92672>.</span>tri_mesh()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>with</span> open(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;example_mesh_</span><span style=color:#e6db74>{</span>i<span style=color:#e6db74>}</span><span style=color:#e6db74>.ply&#39;</span>, <span style=color:#e6db74>&#39;wb&#39;</span>) <span style=color:#66d9ef>as</span> f:
</span></span><span style=display:flex><span>        t<span style=color:#f92672>.</span>write_ply(f)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>with</span> open(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;example_mesh_</span><span style=color:#e6db74>{</span>i<span style=color:#e6db74>}</span><span style=color:#e6db74>.obj&#39;</span>, <span style=color:#e6db74>&#39;w&#39;</span>) <span style=color:#66d9ef>as</span> f:
</span></span><span style=display:flex><span>        t<span style=color:#f92672>.</span>write_obj(f)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#34;All done&#34;</span>)
</span></span></code></pre></div></div></div></div></div></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>python shap-e-test.py</span></span></code></pre></div><p>It also is possible to start a <a href=/grex-docs/specific-soft/jupyter-notebook class=is-pretty-link>Jupyter Notebook</a>
server while being in the same environment and use the model interactively, with example Notebooks provided under <em>shap-e/examples</em>.</p><p>The above scenario is done using interactive <em>salloc</em> job on a GPU node. Interactive sessions are very useful for initializing Python environments and troubleshooting.</p><p>For long-running tasks, it is best to run the ML workloads under SLURM batch mode. The same modules must be loaded inside the SLURM job script, and the same <em>virtualenv</em> must be &ldquo;activated&rdquo; inside the job script as well, before running Python.
An example job script for running the same Python code as a batch job:</p><div class=sc-collapsible-container><div class=sc-collapsible-header>SLURM job script to run the above shap-e Python example</div><div class=sc-collapsible-content><div class=sc-snippet-wrapper><div class=sc-snippet-container><div class=sc-snippet><div class=sc-snippet-caption>run-python-gpu.sh</div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>#SBATCH --gpus=1</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#SBATCH --partition=stamps-b,mcordgpu-b,livi-b</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#SBATCH --ntasks=1 </span>
</span></span><span style=display:flex><span><span style=color:#75715e>#SBATCH --cpus-per-task=4</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#SBATCH --mem=32gb</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#SBATCH --time=0-2:00:00</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#SBATCH --job-name=python-shape-e</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Adjust the resource requests above to your needs.</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Example of loading modules, CUDA and Python from CCEnv:</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># modules for CCEnv Python</span>
</span></span><span style=display:flex><span>module load CCEnv
</span></span><span style=display:flex><span>module load arch/avx512 StdEnv/2023
</span></span><span style=display:flex><span>module load cuda/12.2 cudnn/9.2.1.18
</span></span><span style=display:flex><span>module load python/3.11.5 scipy-stack/2024a
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># activate the existing virtualenv with Torch, Shap-e</span>
</span></span><span style=display:flex><span>source shapee/bin/activate
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># actually run the code/model</span>
</span></span><span style=display:flex><span>python shap-e-test.py
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;Job finished with exit code </span>$?<span style=color:#e6db74> at: `date`&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># end of the script</span>
</span></span></code></pre></div></div></div></div></div></div><p>The script can be submitted as usual, with the sbatch command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sbatch run-python-gpu.sh</span></span></code></pre></div><h3 id=example-2-using-manga-image-translator-with-singularity>Example 2: using manga-image-translator with Singularity<a href=#example-2-using-manga-image-translator-with-singularity class=anchor>#</a></h3><p>Containers are another popular way of managing Python dependencies. In this example, let us try to translate Manga captions using AI code and models from <a href=https://github.com/zyddnys/manga-image-translator class=is-pretty-link>manga-image-translator</a>
. We will need the software and the AI models it is using. While it is possible to build the software from GitHub sources with pip/virtualenv, it can be tricky and time consuming.
The authors of the repository have provided <a href=https://hub.docker.com/r/zyddnys/manga-image-translator class=is-pretty-link>a container image on DockerHub</a>
. We will be using the image on Grex with Singularity/ Apptainer.
Singularity can pull and run many (but not every of them!) Docker images that are simple enough. Inspection of <a href=https://github.com/zyddnys/manga-image-translator/blob/main/Dockerfile class=is-pretty-link>the Docker recipe here</a>
shows that the image is simple because it does not have any USER command. Moreover, we see that there is an ENTRYPOINT defined:</p><blockquote><p>ENTRYPOINT [&ldquo;python&rdquo;, &ldquo;-m&rdquo;, &ldquo;manga_translator&rdquo;]</p></blockquote><p>Knowing the entry point is useful for running the same image with <em>singularity exec</em>. Let us first try to download and convert the Docker image into a new Singularity image in the SISF format.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Lets use singularity to pull the container from DockerHub</span>
</span></span><span style=display:flex><span>module load singularity
</span></span><span style=display:flex><span>singularity pull docker://zyddnys/manga-image-translator:main</span></span></code></pre></div><blockquote><p>The SISF image is large (can be 12 to 15GB). The software will be further downloading a couple of 10s of GBs of the LLM models. To avoid running into disk quota issues, it makes sense to do the work on <em>/project</em> filesystem rather than under <em>/home</em>!</p></blockquote><p>To try running the container on a GPU, we would need to run an interactive session on a GPU node.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Lets get an interactive job on a GPU node using 1 GPU for 2 hours. Note that we&#39;d need more memory for LLama models.</span>
</span></span><span style=display:flex><span>salloc --gpus<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> --partition<span style=color:#f92672>=</span>stamps-b,agro-b,mcordcpu-b --cpus-per-task<span style=color:#f92672>=</span><span style=color:#ae81ff>4</span> --mem<span style=color:#f92672>=</span>100gb --time<span style=color:#f92672>=</span>0-2:00</span></span></code></pre></div><p>There is a documentation on the GitHub site on how to run the models. Naturally it describes how to run it with Docker! But we can understand from it that the code expects two directories with the input and output bind-mounted into the container: /app/source and /app-source-translated.
Docker is using <em>-v</em> flag to bind-mount &ldquo;volumes&rdquo;. Singularity is more humble and just bind-mounts directories with <em>-B</em> flag. Most of other Docker flags can be omitted, except for the GPU related flag that has to be replaced with <em>&ndash;nv</em> for Singularity).</p><p>Let us not forget what the &ldquo;entrypoint&rdquo; was! And what were the options required for the Python code itself as distinct to Sing/Docker options to execute the container.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Create source and source-translated directories </span>
</span></span><span style=display:flex><span>mkdir source
</span></span><span style=display:flex><span>mkdir source-translated
</span></span><span style=display:flex><span><span style=color:#75715e># The example Comics image for AI to work on, from the Github pages of the manga translator. </span>
</span></span><span style=display:flex><span><span style=color:#75715e># Please make sure to follow all the applicable Copyrigth laws when using pictures from the Internet.</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cd source <span style=color:#f92672>&amp;&amp;</span> wget https://user-images.githubusercontent.com/31543482/232265479-a15c43b5-0f00-489c-9b04-5dfbcd48c432.png 
</span></span><span style=display:flex><span>cd ..
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># lets try to run the container, finally</span>
</span></span><span style=display:flex><span>singularity exec   --nv  -B <span style=color:#e6db74>`</span>pwd<span style=color:#e6db74>`</span>/source:/app/source -B <span style=color:#e6db74>`</span>pwd<span style=color:#e6db74>`</span>/source-translated:/app/translated manga-image-translator_main.sif python -m manga_translator --use-gpu -l ENG -i source  -v --translator<span style=color:#f92672>=</span>sugoi -m batch --overwrite   --manga2eng</span></span></code></pre></div><p>The command above fails! The error mentions something about a directory &ldquo;/app/models/translatiors&rdquo;.
The reason is that unlike Docker, Singularity containers are read-only and cannot download or create any new massive data into the existing image. To work around the issue, we would need one more directory, &ldquo;/app/models/translators&rdquo; bind mounted for the LLM models it tries to download.
Also, adding <em>&ndash;writable-tmpfs</em> for ephemeral temporary filesystems is often needed for Python codes in Singularity.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>## the directories and test image should already exist from the above example. Lets add translators and bind-mount it to /app/models!</span>
</span></span><span style=display:flex><span>mkdir translators
</span></span><span style=display:flex><span>singularity exec --writable-tmpfs  --nv -B <span style=color:#e6db74>`</span>pwd<span style=color:#e6db74>`</span>/translators:/app/models/translators -B <span style=color:#e6db74>`</span>pwd<span style=color:#e6db74>`</span>/source:/app/source -B <span style=color:#e6db74>`</span>pwd<span style=color:#e6db74>`</span>/source-translated:/app/translated manga-image-translator_main.sif python -m manga_translator --use-gpu -l ENG -i source  -v --translator<span style=color:#f92672>=</span>sugoi -m batch --overwrite   --manga2eng</span></span></code></pre></div><p>When the command finishes, the <em>./source-translated</em> would contain a image with Japanese text translated to English.</p><h3 id=example-3-using-manga-image-translator-with-podman>Example 3: using manga-image-translator with Podman<a href=#example-3-using-manga-image-translator-with-podman class=anchor>#</a></h3><p>Singularity is the preferred container engine on our shared HPC systems. However, there are cases when Singularity/Apptainer SISF images would not run Docker images correctly.
In these cases, root-less Podman can be used. Both the Alliance&rsquo;s <em>CCEnv</em> and Grex&rsquo;s <em>SBEnv</em> provide a module for Podman. Using Podman is very similar to using Docker in that Podman supports same command line options.
However, use of Podman in cases when Singularity fails is also more advanced and it would need additional options for user namespace and user/group ID mappings. In general, our support of Podman is as of now considered experimental.</p><p>In our example, we would not need these advanced namespaces options because the <em>manga-image_translator</em> is well built to work in either Singularity or Docker.</p><p>To try running the container on a GPU, we would need to run an interactive session on a GPU node.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Lets get an interactive job on a GPU node using 1 GPU for 2 hours. Note that we&#39;d need more memory for LLama models.</span>
</span></span><span style=display:flex><span>salloc --gpus<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> --partition<span style=color:#f92672>=</span>stamps-b,agro-b,mcordcpu-b --cpus-per-task<span style=color:#f92672>=</span><span style=color:#ae81ff>4</span> --mem<span style=color:#f92672>=</span>100gb --time<span style=color:#f92672>=</span>0-2:00</span></span></code></pre></div><p>Then, we would do exactly the same sequence of commands but with Podman instead of Singularity.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Lets use podman</span>
</span></span><span style=display:flex><span>module load podman
</span></span><span style=display:flex><span><span style=color:#75715e># directories to bind-mount</span>
</span></span><span style=display:flex><span>mkdir source
</span></span><span style=display:flex><span>mkdir source-translated
</span></span><span style=display:flex><span><span style=color:#75715e># The example Comics image for AI to work on, from the Github pages of the manga translator. </span>
</span></span><span style=display:flex><span><span style=color:#75715e># Please make sure to follow all the applicable Copyrigth laws when using pictures from the Internet!</span>
</span></span><span style=display:flex><span>cd source <span style=color:#f92672>&amp;&amp;</span> wget https://user-images.githubusercontent.com/31543482/232265479-a15c43b5-0f00-489c-9b04-5dfbcd48c432.png 
</span></span><span style=display:flex><span>cd ..
</span></span><span style=display:flex><span>mkdir translators
</span></span><span style=display:flex><span><span style=color:#75715e># running it with podman. Note the more options like --rm, and how the GPU is handled with --device.</span>
</span></span><span style=display:flex><span>podman run --rm --device<span style=color:#f92672>=</span>nvidia.com/gpu<span style=color:#f92672>=</span>all --ipc<span style=color:#f92672>=</span>host -v <span style=color:#e6db74>`</span>pwd<span style=color:#e6db74>`</span>/translators:/app/models/translators -v <span style=color:#e6db74>`</span>pwd<span style=color:#e6db74>`</span>/source:/app/source -v <span style=color:#e6db74>`</span>pwd<span style=color:#e6db74>`</span>/source-translated:/app/translated docker://zyddnys/manga-image-translator:main --use-gpu -l ENG -i source  -v --translator<span style=color:#f92672>=</span>sugoi -m batch --overwrite  --manga2eng</span></span></code></pre></div><blockquote><p>Note that the Podman example also bind-mounts the <em>./translators</em> . Even thought it might work without it, it does make a lot of sense to bind-mount ./translators to avoid re-downloading the LLM models into Docker containers&rsquo; image every time we run a new container instance using them!</p></blockquote><h2 id=external-links>External links<a href=#external-links class=anchor>#</a></h2><hr><ul><li>The Alliance documentation about <a href=https://docs.alliancecan.ca/wiki/Python class=is-pretty-link>Python</a></li><li>The Alliance list of <a href=https://docs.alliancecan.ca/wiki/Available_Python_wheels class=is-pretty-link>Available wheels</a></li><li>An old talk by Bart Oldeman at CC/DRAC <a href=https://indico.cism.ucl.ac.be/event/4/contributions/33/attachments/33/65/Python_at_Compute_Canada1.pdf class=is-pretty-link>Python at ComputeCanada</a></li></ul><h3 id=training-huggingface-llms-on-alliance-systems>Training Huggingface LLMs on Alliance systems<a href=#training-huggingface-llms-on-alliance-systems class=anchor>#</a></h3><p>A new documentation item covers on how to download and use <a href=https://docs.alliancecan.ca/wiki/Huggingface#Training_Large_Language_Models_%5c%28LLMs%5c%29 class=is-pretty-link>HuggingFace models on Alliance Software stack</a>
.
This documentation largely applies to Grex as well, when using CCEnv software stack.</p></div><div class="column is-sticky is-paddingless" id=tocWrapper><div class=is-paddingless id=tocContainer><div class=toc-header><h6 class="toc-title is-marginless">On this page:</h6><i title="Back to top" id=tocBackToTop class="fa-solid fa-circle-arrow-up"></i></div><div id=tocContent><div id=toc><nav id=TableOfContents><ul><li><a href=#introduction>Introduction</a></li><li><a href=#examples-of-use-cases>Examples of Use Cases</a><ul><li><a href=#example-1-using-openai-shape-e-in-ccenv-virtualenv>Example 1: using OpenAI shape-e in CCEnv virtualenv</a></li><li><a href=#example-2-using-manga-image-translator-with-singularity>Example 2: using manga-image-translator with Singularity</a></li><li><a href=#example-3-using-manga-image-translator-with-podman>Example 3: using manga-image-translator with Podman</a></li></ul></li><li><a href=#external-links>External links</a><ul><li><a href=#training-huggingface-llms-on-alliance-systems>Training Huggingface LLMs on Alliance systems</a></li></ul></li></ul></nav></div><div id=taxonomies><div class=taxonomy-wrapper><div class=toc-header><h6 class="toc-title is-marginless">Categories</h6></div><a href=/grex-docs/categories/software/ class=taxonomy><i class="fa-solid fa-circle-dot"></i>Software</a><a href=/grex-docs/categories/applications/ class=taxonomy><i class="fa-solid fa-circle-dot"></i>Applications</a><a href=/grex-docs/categories/ml/ class=taxonomy><i class="fa-solid fa-circle-dot"></i>ML</a></div><div class=taxonomy-wrapper></div></div></div></div><div class=is-paddingless id=tocCollapsible title="Collapse/Uncollapse table of contents"><i class="fa-solid fa-angles-right fa-lg"></i></div></div></div></div><script type=text/javascript>const baseUrl="https://um-grex.github.io/grex-docs/",codeCopyBefore="Copy to clipboard",codeCopyAfter="Copied to clipboard",svgDownloadLabel="Download as SVG",helperLoadingLabel="Loading",searchNoResults="No result found",introNextLabel="Next",introPrevLabel="Previous",introSkipLabel="✗",introDoneLabel="Done",printLabel="Print current page",qrCodeLabel="Show current page QR code",naCommonLabel="Not available"</script><script type=module src=/grex-docs/js/theme/modules/const.min.js></script><script type=module src=/grex-docs/js/theme/modules/helpers.min.js></script><script type=module src=/grex-docs/js/theme/modules/helpersGlobal.min.js></script><script type=module src=/grex-docs/js/theme/init.min.js></script><script type=module src=/grex-docs/js/theme/navbar.min.js></script><script type=module src=/grex-docs/js/theme/print.min.js></script><script type=module src=/grex-docs/js/theme/qrcode.min.js></script><script type=module src=/grex-docs/js/theme/search.min.js></script><script type=module src=/grex-docs/js/theme/shortcuts.min.js></script><script type=module src=/grex-docs/js/theme/sidebar.min.js></script><script type=module src=/grex-docs/js/theme/toc.min.js></script><script type=module src=/grex-docs/js/shortcodes/collapsible.min.js></script><script type=module src=/grex-docs/js/shortcodes/treeview.min.js></script><script type=text/javascript src=/grex-docs/js/theme/browserCompatibility.min.js></script><script type=text/javascript src=/grex-docs/js/external/flexsearch/flexsearch.bundle.min.js></script><script type=text/javascript src=/grex-docs/js/external/qrious/qrious.min.js></script><script type=text/javascript src=/grex-docs/js/external/overlay-scrollbars/overlayscrollbars.min.js></script></body></html>