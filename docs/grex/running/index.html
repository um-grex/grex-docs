<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Running Jobs"><meta property="og:title" content="Running Jobs"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:url" content="http://um-grex.github.io/grex-docs/docs/grex/running/"><title>Running Jobs | Unofficial Grex User Guide</title><link rel=icon href=/grex-docs/favicon.png type=image/x-icon><link rel=stylesheet href=/grex-docs/book.min.9e24c4795dd4fdd0e504b497cfd7198ef04d9fc59147fe183e68ca7912ee2901.css integrity="sha256-niTEeV3U/dDlBLSXz9cZjvBNn8WRR/4YPmjKeRLuKQE="><script defer src=/grex-docs/en.search.min.937d4ab3854d0ccdbf7b51efffef2b32e172b767bc77ffbc44e0fae199393916.js integrity="sha256-k31Ks4VNDM2/e1Hv/+8rMuFyt2e8d/+8ROD64Zk5ORY="></script><link rel=alternate type=application/rss+xml href=http://um-grex.github.io/grex-docs/docs/grex/running/index.xml title="Unofficial Grex User Guide"></head><body><input type=checkbox class=hidden id=menu-control><main class="flex container"><aside class="book-menu fixed"><nav><h2 class=book-brand><a href=http://um-grex.github.io/grex-docs><img src=/grex-docs/um_logo_email_signature.png alt=Logo><span>Unofficial Grex User Guide</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64><div class="book-search-spinner spinner hidden"></div><ul id=book-search-results></ul></div><ul><li class=book-section-flat><a href=/grex-docs/docs/longread/>Notes of Grex Changes</a><ul><li class=book-section-flat><a href=/grex-docs/docs/longread/training/>Training Materials and Presentations</a><ul></ul></li></ul></li><li class=book-section-flat><a href=/grex-docs/docs/computecanada/>Accessing Compute Canada resources</a><ul></ul></li><li class=book-section-flat><a href=/grex-docs/docs/grex/>Grex HPC Documentation</a><ul><li><a href=/grex-docs/docs/grex/access/>Access and Usage conditions</a></li><li><a href=/grex-docs/docs/grex/connecting/>Connecting / Transferring data</a></li><li><a href=/grex-docs/docs/grex/data/>Storage and Data</a></li><li><a href=/grex-docs/docs/grex/running/ class=active>Running Jobs</a><ul><li><a href=/grex-docs/docs/grex/running/batch/>Batch jobs</a></li><li><a href=/grex-docs/docs/grex/running/interactive/>Interactive work</a></li><li><a href=/grex-docs/docs/grex/running/contributed-systems/>Contributed systems</a></li></ul></li><li><a href=/grex-docs/docs/grex/software/>Software</a></li></ul></li><li><a href=/grex-docs/docs/faq/>Frequently Asked Questions</a></li><li><a href=/grex-docs/docs/localit/>Local IT Resources</a></li><li><a href=/grex-docs/docs/support-contacts/>Support and Training</a></li><li><a href=/grex-docs/docs/disclaimer/>Disclaimer</a></li></ul></nav><script>(function(){var a=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(b){localStorage.setItem("menu.scrollTop",a.scrollTop)}),a.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></aside><div class=book-page><header class="flex align-center justify-between book-header"><label for=menu-control><img src=/grex-docs/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Running Jobs</strong></header><article class=markdown><h1 id=running-jobs>Running Jobs</h1><h2 id=why-running-jobs-in-batch-mode>Why running jobs in batch mode?</h2><p>There is a number of reasons for adopting a batch mode for running jobs on a cluster. From providing user&rsquo;s computations with fairness, traffic control to prevent resource congestion and resource trashing, enforcing organizational priorities, to better understanding the workload, utilization and resource needs for future capacity planning; the scheduler provides it all.
After being long-time PBS/Moab users, we have switched to the SLURM batch system since December 2019.</p><h2 id=partitions>Partitions</h2><p>The current Grex system that has contributed nodes, large memory nodes and contributed GPU nodes is (and getting more and more) heterogeneous. With SLURM as a scheduler, this requires partitioning: a &ldquo;partition&rdquo; is a set of compute nodes, groupped by a characteristic, usuall by kind of hardware the node has, and sometimes by who &ldquo;owns&rdquo; the hardware as well.</p><p>There is no fully automatic selection of partitions, other than the default <em>skylake</em> for most of the users, and <em>compute</em> for the short jobs. For the contributors' group members, the default partition will be their contributed nodes. <strong>Thus in many cases users have to specify the partition manually when submitting their jobs!</strong></p><p>Currently, the following partitions are available on Grex:</p><ul><li><strong>skylake</strong> : the new 52-core, CascadeLakeRefresh compute nodes, 96 Gb/node (set as the default partition) <strong>NEW</strong></li><li><strong>largemem</strong> : the new 40-core, CascadeLake compute nodes, 384 Gb/node <strong>NEW</strong></li><li><strong>compute</strong> : the original SSE4.2 12-core Grex nodes, RAM 48Gb/node (no longer set as the default partition for jobs over 30min)</li><li><strong>gpu</strong> : two GPU V100/32GB AVX512 nodes, RAM 192GB/node <strong>NEW</strong></li><li><strong>stamps</strong> : three 4xGPU v100/16GB AVX512 nodes contributed by Prof. R. Stamps (Department of Physics and Astronomy)</li><li><strong>livi</strong> : a HGX-2 16xGPU V100/32GB, NVSwitch server contributed by Prof. L. Livi (Department of Computer Science)</li><li><strong>stamps-b</strong> : Preemptible partition for general use of the above nodes contributed by Prof. R. Stamps.</li><li><strong>livi-b</strong> : Preemptible partition for general use of the above nodes contributed by Prof. L. Livi.</li></ul><p>The former four partitions (<strong>skyake</strong>, <strong>compute</strong>, <strong>largemem</strong> and <strong>gpu</strong>) are generally accessible. The next three are open only to the contributor&rsquo;s groups.</p><p>On the contributed partitions, the owner&rsquo;s group has preferencial access. However, users belonging to other groups can submit jobs to one of the preemptible partitions (ending with <strong>-b</strong>) to run on the contributed hardware as long as it is unused, on the condition that their jobs can be preempted (that is, killed) should owners jobs need the hardware.
There is a minimum runtime guaranteed to preemptible jobs, which is as of now 1 hour. The maximum walltime for the preemptible partition is set per partition (and can be seen in the output of the <em>sinfo</em> command).</p><p>Jobs cannot span several partitions; but it is possible to specify more than one partiton, like in <em>--partition=compute,bigmem</em> so that the job will be directed by the scheduler
to the first partiton available.</p><p>Jobs will be rejected by the SLURM scheduler if partition&rsquo;s hardware and requested resources do not match
(that is, asking for GPUs on compute or bigmem partitions is not possible). So in some cases, explicitly adding_--partition=_ flag to SLURM job submission is needed.
Jobs that require *stamps-b* partiton have to use GPUs, otherwise they will be rejected; this is to prevent of bogging up the precious GPU nodes with CPU-only jobs!</p><h2 id=accounts>Accounts</h2><p>Users belong to &ldquo;accounting groups&rdquo;, led by their principal investigators (PIs). The accounting grops on Grex match CCDB roles. By default, a user&rsquo;s jobs are assigned to his primary/default accounting group. But it is possible for a user to belong to more than one group; then the <em>--account=</em> parameter can be used for <em>sbatch</em> or <em>salloc</em> to select non-default account to run jobs under.</p><h2 id=qoss>QOSs</h2><p>QOS stands for Quality of Service. It is a mechanism to modify scheduler&rsquo;s limits, hardware access policies and modify job priorities and job accounting/billing.
Presently, QOS might be used by our Scheduler machinery internally, but not specified by the users. Jobs that specify explicit <em>&ndash;qos=</em> will be rejected by the
SLURM job submission wrapper.</p><h2 id=limits-and-policies>Limits and policies</h2><p>In order to prevent monopolization of the entire cluster by a single user or single accountig group, we enforce a MAXPS like limit;
for non-RAC accounts it is set to 4M CPU-minutes and 400 CPU cores. Accounts that have allocation (RAC) on Grex get higher MAXPS and max
CPU cores limits in order to let them to utilize their usage targets.</p><p>Partitions for preemptible jobs running on contributed hardware might be further limited, so that they can not occupy the whole contributed hardware.</p><p>In cases when Grex is underutilized, but some jobs exist in the queue that can be run if not for the above mentioned limits,
we might relax the limits as a temporary &ldquo;bonus&rdquo;.</p><h2 id=slurm-commands>SLURM commands</h2><p>Naturally, SLURM provides a command line user interface. Some of the most useful commands are listed below.</p><h3 id=exploring-the-system>Exploring the system</h3><p>The SLURM command that shows state of nodes and partitions is &lsquo;&lsquo;sinfo&rsquo;&rsquo;</p><p><code>sinfo</code></p><h3 id=submitting-jobs>Submitting jobs</h3><p>Batch jobs are submitted as follow:</p><p><code>sbatch [options] myfile.job</code></p><p>Interactive jobs are submitted in exactly same way, but they do not need the job script because they will give you an interactive session:</p><p><code>salloc [options]</code></p><p>The command <em>sbatch</em> returns a number called JobID and used by SLURM to identify the job in the queuing system.</p><p>The options are used to specify resources (wall time, tractable resources such as cores and nodes and GPUs) and accounts and QOS and partitions under which the jobs should run, and various other options like specifying whether jobs need X11 GUI (--x11), where its output should go, whether email should be sent when job changes its states and so on. Here is a list of the most frequent options to <em>sbatch</em> command:</p><p>Resources (tractable resources in SLURMspeak) are CPU time, memory, and GPU time.</p><p>Generic resources can be software licenses, etc. There are also options to control job placement such as partitions and QOSs.</p><ul><li><em>--ntasks=</em> : specifies number of tasks (MPI processes) per job.</li><li><em>--nodes=</em> : specifies number of nodes (servers) per job.</li><li><em>--ntasks-per-node=</em> : works with</li><li><em>--cpus-per-task=</em> : specifies number of threads per task.</li><li><em>--mem-per-cpu=</em> : specifies memory per task (or thread?)</li><li><em>--mem=</em> : specifies the memory per node.</li><li><em>--gpus=</em> : specifies number of GPUs per job. There are also <em>--gpus-per-XXX</em> and <em>--XXX-per-gpu</em></li><li><em>--time-</em> : specifies walltime in format DD-HH:MM</li><li><em>--qos=</em> : specifies a QOS by its name (Should not be used on Grex!)</li><li><em>--partition=</em> : specifies a partiton by its name (Can be very useful on Grex!)</li></ul><p>An example of using some of these options with <em>sbatch</em> and <em>salloc</em> are listed below:</p><p><code>sbatch --nodes=1 --ntasks-per-node=1 --cpus-per-task=12 --mem=40gb --time=0-48:00 gaussian.job</code></p><p><code>salloc --nodes=1 --ntasks-per-node=4 --mem-per-cpu=4000mb --x11 --partition=compute</code></p><p>And so on. The options for batch jobs can be either in command line, or (perhaps better) in the special comments in the job file, like &lsquo;'#SBATCH --mem=40gb '&rsquo;</p><p>Refer to the subsection for Batch jobs and Interacive jobs for more information, examples of job scripts and how to actually sumbit jobs.</p><h3 id=monitoring-jobs>Monitoring jobs</h3><p>Checking on the queued jobs:</p><p><code>squeue -u auser</code></p><p><code>squeue -A abc-12-aa</code></p><p>Without the above parameters, squeue would return all the jobs in the system. There is a shortcut &lsquo;&lsquo;sq&rsquo;&rsquo; for &lsquo;&lsquo;squeue -u $USER&rsquo;&rsquo;</p><p>Cancelling jobs:</p><p><code>scancel JobID</code></p><p><code>echo "Deleting all the jobs by $USER" && scancel -u $USER</code></p><p><code>echo "Deleting all the pending jobs by $USER" && scancel -u $USER --state=pending</code></p><p>Hold and release queued jobs:</p><p><code>scontrol hold JobID</code></p><p><code>scontrol release JobID</code></p><p>Checking job efficiency (the actual utilization of walltime and memory):</p><p><code>seff JobID</code></p><p>Checking resource limits and usage for past and current jobs:</p><p><code>sacct -j {JobID} -l</code></p><p><code>sacct -u $USER -s {STARTDATE} -e {ENDDATE} -l --parsable2</code></p><h3 id=getting-info-on-accounts-and-priorities>Getting info on accounts and priorities</h3><p>Fairshare and accounting information for the accounting group &lsquo;&lsquo;abc-12-aa&rsquo;&rsquo;</p><p><code>sshare -a -l -A abc-12-aa</code></p><p>Fairshare and accounting information for a user:</p><p><code>sshare -l -U -u $USER</code></p><p>Limits and settings for an account:</p><p><code>sacctmgr list assoc account=abc-12-aa format=account,user,qos</code></p><h2 id=useful-links>Useful links</h2><ul><li>SLURM <a href=https://westgrid.github.io/trainingMaterials/tools/scheduling/>documentation</a></li><li><a href=https://docs.computecanada.ca/wiki/Running_jobs>Running jobs</a> on Compute Canada clusters.</li><li>References for migrating from PBS to SLURM: <a href=https://www.ichec.ie/academic/national-hpc/kay-documentation/pbs-slurm>ICHEC</a>, <a href=https://hpcc.usc.edu/support/documentation/pbs-to-slurm/>HPC-USC</a></li><li>Westgrid training materials on SLURM: <a href=https://westgrid.github.io/trainingMaterials/tools/scheduling/>Scheduling</a></li></ul><p>Since the HPC technology is widely used by most of universities and National labs, simple googling your SLURM question will likely return a few useful links to their HPC/ARC documentations.</p></article><div class="book-footer justify-between"><div><a class="flex align-center" href=https://github.com/um-grex/grex-docs/commit/98901312c7a057d20e249e2d633e282a24374129 title="Last modified by Shamov | Sep 24, 2021" target=_blank><img src=/grex-docs/svg/calendar.svg class=book-icon alt=Calendar>
<span>Sep 24, 2021</span></a></div><div><a class="flex align-center" href=https://github.com/um-grex/grex-docs/blob/master/content/docs/grex/running/_index.md target=_blank><img src=/grex-docs/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div></div><aside class="book-toc levels-4 fixed"><nav id=TableOfContents><ul><li><a href=#running-jobs>Running Jobs</a><ul><li><a href=#why-running-jobs-in-batch-mode>Why running jobs in batch mode?</a></li><li><a href=#partitions>Partitions</a></li><li><a href=#accounts>Accounts</a></li><li><a href=#qoss>QOSs</a></li><li><a href=#limits-and-policies>Limits and policies</a></li><li><a href=#slurm-commands>SLURM commands</a><ul><li><a href=#exploring-the-system>Exploring the system</a></li><li><a href=#submitting-jobs>Submitting jobs</a></li><li><a href=#monitoring-jobs>Monitoring jobs</a></li><li><a href=#getting-info-on-accounts-and-priorities>Getting info on accounts and priorities</a></li></ul></li><li><a href=#useful-links>Useful links</a></li></ul></li></ul></nav></aside></main></body></html>