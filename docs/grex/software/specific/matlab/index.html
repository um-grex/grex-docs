<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Matlab"><meta property="og:title" content><meta property="og:description" content="Matlab on Grex Introduction MATLAB is a general-purpose high-level programming package for numerical work such as linear algebra, signal processing and other calculations involving matrices or vectors of data. We have a campus license for MATLAB which is used on Grex and other local computing resources. MATLAB is available only for UManitoba users.
As most of the Grex software, MATLAB is available as module. The following command will load the latest version available on Grex:"><meta property="og:type" content="article"><meta property="og:url" content="http://um-grex.github.io/grex-docs/docs/grex/software/specific/matlab/"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2022-02-16T11:44:23-06:00"><title>Matlab | Unofficial Grex User Guide</title><link rel=icon href=/grex-docs/favicon.png type=image/x-icon><link rel=stylesheet href=/grex-docs/book.min.06cbd313f49ddc884804421299d5dc11b1cd097fdcfed7f054a79a137890a2d7.css integrity="sha256-BsvTE/Sd3IhIBEISmdXcEbHNCX/c/tfwVKeaE3iQotc="><script defer src=/grex-docs/en.search.min.f4135ebeadea4f6cc693545624b7dead31a8c7771e1d5129009b9f66d1d02f81.js integrity="sha256-9BNevq3qT2zGk1RWJLferTGox3ceHVEpAJufZtHQL4E="></script></head><body><input type=checkbox class=hidden id=menu-control><main class="flex container"><aside class="book-menu fixed"><nav><style>hr{border:0;height:3px;background-image:linear-gradient(to right,transparent,#095484,transparent)}</style><h2 class=book-brand><a href=http://um-grex.github.io/grex-docs><img src=/grex-docs/logo/um_logo_email_signature.png style=width:auto;height:auto alt=Logo><br><hr><span>Unofficial Grex User Guide</span><hr></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64><div class="book-search-spinner spinner hidden"></div><ul id=book-search-results></ul></div><hr><ul><li class=book-section-flat><a href=/grex-docs/docs/longread/>Notes of Grex Changes</a><ul><li class=book-section-flat><a href=/grex-docs/docs/longread/training/>Training Materials and Presentations</a><ul></ul></li></ul></li><li class=book-section-flat><a href=/grex-docs/docs/computecanada/>Accessing Compute Canada resources</a><ul></ul></li><li class=book-section-flat><a href=/grex-docs/docs/grex/>Grex HPC QuickStart</a><ul><li><a href=/grex-docs/docs/grex/access/>Access and Usage conditions</a></li><li><a href=/grex-docs/docs/grex/connecting/>Connecting / Transferring data</a></li><li><a href=/grex-docs/docs/grex/data/>Storage and Data</a></li><li><a href=/grex-docs/docs/grex/running/>Running Jobs</a></li><li><a href=/grex-docs/docs/grex/ood/>Grex's OpenOnDemand Web Portal</a></li><li><a href=/grex-docs/docs/grex/software/>Software</a><ul><li><a href=/grex-docs/docs/grex/software/cern-vmfs/>CVMFS and ComputeCanada</a></li><li><a href=/grex-docs/docs/grex/software/general-linux/>General Linux tools</a></li><li><a href=/grex-docs/docs/grex/software/containers/>Containers for Software</a></li><li><a href=/grex-docs/docs/grex/software/code-development/>Code Development on Grex</a></li><li><a href=/grex-docs/docs/grex/software/jupyter-notebook/>Using JuPyTer Notebooks</a></li><li><a href=/grex-docs/docs/grex/software/specific/>Software-specific notes</a><ul><li><a href=/grex-docs/docs/grex/software/specific/gaussian/>Gaussian</a></li><li><a href=/grex-docs/docs/grex/software/specific/julia/>Julia</a></li><li><a href=/grex-docs/docs/grex/software/specific/lammps/>Lammps</a></li><li><a href=/grex-docs/docs/grex/software/specific/matlab/ class=active>Matlab</a></li><li><a href=/grex-docs/docs/grex/software/specific/nwchem/>Nwchem</a></li><li><a href=/grex-docs/docs/grex/software/specific/orca/>Orca</a></li><li><a href=/grex-docs/docs/grex/software/specific/priroda/>Priroda</a></li><li><a href=/grex-docs/docs/grex/software/specific/vasp/>Vasp</a></li></ul></li></ul></li></ul></li><li><a href=/grex-docs/docs/faq/>Frequently Asked Questions</a></li><li><a href=/grex-docs/docs/localit/>Local IT Resources</a></li><li><a href=/grex-docs/docs/support-contacts/>Support and Training</a></li><li><a href=/grex-docs/docs/disclaimer/>Disclaimer</a></li></ul></nav><script>(function(){var a=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(b){localStorage.setItem("menu.scrollTop",a.scrollTop)}),a.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></aside><div class=book-page><article class=markdown><h1 id=matlab-on-grex>Matlab on Grex</h1><h2 id=introduction>Introduction</h2><p><a href=http://www.mathworks.com/ target=_blank rel=noopener>MATLAB</a>
is a general-purpose high-level programming package for numerical work such as linear algebra, signal processing and other calculations involving matrices or vectors of data. We have a campus license for MATLAB which is used on Grex and other local computing resources. MATLAB is available only for UManitoba users.</p><p>As most of the Grex software, MATLAB is available as module. The following command will load the latest version available on Grex:</p><blockquote class="book-hint info"><code>module load uofm/matlab</code></blockquote><p>Then the <strong>matlab</strong> executable will be in the PATH.</p><h2 id=running-matlab>Running Matlab</h2><p>It is possible to run MATLAB GUI interactively, for best performance in an X2Go session and terminal. There is no <strong>Applications</strong> menu shortcut for MATLAB, because it is only in the PATH after the module is loaded from command line. After loading the module, the command will be in the PATH:</p><blockquote class="book-hint info"><code>matlab</code></blockquote><p>For running a MATLAB script in text mode, or a batch script, the following options can be used.</p><blockquote class="book-hint info"><code>matlab -nodisplay -nojvm -nodesktop -nosplash -r your_matlab_script.m</code></blockquote><p>However, each instance, GUI or command line, will consume a license unit. By submitting sufficiently many MATLAB jobs concurrently, it is possibly to exaust entire University&rsquo;s license pool. Thus in most cases, it might make sense to use compiled, standalone MATLAB code runners (MCRs) instead.</p><h3 id=standalone-matlab-runners>Standalone Matlab runners</h3><p>MATLAB comiler, the <strong>mcc</strong> command can be used to compile source code (<strong>.m</strong> files) into a standalone excecutable. There is a couple of important considerations to keep in mind when creating an executable that can be run in the batch-oriented, HPC environment. One is that there is no graphical display attached to your session and the other is that the number of threads used by the standalone application has to be controlled.</p><p>For example, with code <strong>mycode.m</strong> a source directory <strong>src</strong>, with the compiled files being written to a directory called <strong>deploy</strong>, the following <strong>mcc</strong> command line (at the Linux shell prompt) could be used:</p><blockquote class="book-hint info"><p><code>mkdir deploy</code></p><p><code>cd src</code></p><p><code>mcc -R -nodisplay -R -singleCompThread -m -v -w enable -d ../deploy mycode.m</code></p></blockquote><p>Note the option <strong>-singleCompThread</strong> has been included in order to limit the executable to just one computational thread.</p><p>In the deploy directory, an executable mycode will be created along with a script <strong>run_mycode.sh</strong>. These two files should be copied to the target machine where the code is to be run.</p><h3 id=example-of-slurm-script>Example of SLURM script</h3><p>After the standalone executable mycode and corresponding script run_mycode.sh have been transferred to a directory on the target system on which they will be run, a batch job script needs to be created in the same directory. Here is an example batch job script.</p><blockquote class="book-hint slurm"><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:teal>#!/bin/bash
</span><span style=color:teal></span><span style=color:#080;font-style:italic>#SBATCH --cpus-per-task=1</span>
<span style=color:#080;font-style:italic>#SBATCH --mem-per-cpu=4000mb</span>
<span style=color:#080;font-style:italic>#SBATCH --time=0-3:00:00</span>
<span style=color:#080;font-style:italic>#SBATCH --job-name=Matlab-mcr-job</span>
<span style=color:#080;font-style:italic># Choose the MCR directory according to the compiler version used</span>
<span style=color:#080;font-style:italic># The one below for uofm/matlab/R2017A</span>
MCR=/global/software/matlab/mcr/v93
<span style=color:#080;font-style:italic># If running on Grex, uncomment the following line to set MCR_CACHE_ROOT:</span>
module load mcr/mcr
echo <span style=color:#00f>&#34;Running on host: `hostname`&#34;</span>
echo <span style=color:#00f>&#34;Current working directory is `pwd`&#34;</span>
echo <span style=color:#00f>&#34;Starting run at: `date`&#34;</span> 
./run_mycode.sh $MCR &gt; mycode_<span style=color:#00f>${</span>SLURM_JOBID<span style=color:#00f>}</span>.out
echo <span style=color:#00f>&#34;Program finished with exit code </span>$?<span style=color:#00f> at: `date`&#34;</span></code></pre></div></blockquote><p>The job is then submitted as any ordinary SLURM job with the sbatch command. See the Running Jobs page for more information. If the above script is called matlab.job, it could be submitted using:</p><blockquote class="book-hint info"><code>sbatch matlab.job</code></blockquote><p>The specified <strong>--time</strong> and total memory (<strong>--mem-per-cpu</strong>) limits should be adjusted to appropriate values for your particular run.</p><p>An important part of the above script is the location of the MATLAB Compiler Runtime (MCR) directory. This directory contains files necessary for the standalone application to run. The version of the MCR files specified must match the version of MATLAB used to compile the code (check the <a href=https://www.mathworks.com/matlabcentral/answers/102061-what-is-the-version-of-the-matlab-compiler-runtime-mcr-that-corresponds-to-the-version-of-matlab-c target=_blank rel=noopener>link</a>
for mathing module and MCR versions).</p><h2 id=links>Links</h2><p>(Work in progress)</p></article><div class="book-footer justify-between"><div><a class="flex align-center" href=https://github.com/um-grex/grex-docs/commit/4a07d74120d95d4386c1c274f941df41cb1cc57e title="Last modified by Shamov | Feb 16, 2022" target=_blank><img src=/grex-docs/svg/calendar.svg class=book-icon alt=Calendar>
<span>Feb 16, 2022</span></a></div><div><a class="flex align-center" href=https://github.com/um-grex/grex-docs/blob/master/content/docs/grex/software/specific/matlab.md target=_blank><img src=/grex-docs/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div><br><hr></div><aside class="book-toc levels-4 fixed"><nav id=TableOfContents><ul><li><a href=#matlab-on-grex>Matlab on Grex</a><ul><li><a href=#introduction>Introduction</a></li><li><a href=#running-matlab>Running Matlab</a><ul><li><a href=#standalone-matlab-runners>Standalone Matlab runners</a></li><li><a href=#example-of-slurm-script>Example of SLURM script</a></li></ul></li><li><a href=#links>Links</a></li></ul></li></ul></nav></aside></main></body></html>