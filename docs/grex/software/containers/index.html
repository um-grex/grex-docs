<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Containers for Software"><meta property="og:title" content="Containers for Software"><meta property="og:description" content="Introduction Linux Containers are means to isolate software dependencies from the base Linux operation system. On Grex, we support the Singularity container system, now developed by a company called SyLabs. Several other Linux containers engines exist, most notably Docker which is a very popular tool in DevOps community. Presently Docker containers cannot be directly supported on shared HPC systems like Grex. However, with help of Singularity, it is possible to run Docker images from the DockerHub , as well as native Singularity images from other repositories, such as SingularityHub and SyLabsCloud ."><meta property="og:type" content="article"><meta property="og:url" content="http://um-grex.github.io/grex-docs/docs/grex/software/containers/"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2022-02-16T11:44:23-06:00"><title>Containers for Software | Unofficial Grex User Guide</title><link rel=icon href=/grex-docs/favicon.png type=image/x-icon><link rel=stylesheet href=/grex-docs/book.min.06cbd313f49ddc884804421299d5dc11b1cd097fdcfed7f054a79a137890a2d7.css integrity="sha256-BsvTE/Sd3IhIBEISmdXcEbHNCX/c/tfwVKeaE3iQotc="><script defer src=/grex-docs/en.search.min.37ac0874cb6b822c44c1c81fe11f65490c7bb1f4f92bd6c254c4497ec5a04f20.js integrity="sha256-N6wIdMtrgixEwcgf4R9lSQx7sfT5K9bCVMRJfsWgTyA="></script></head><body><input type=checkbox class=hidden id=menu-control><main class="flex container"><aside class="book-menu fixed"><nav><style>hr{border:0;height:3px;background-image:linear-gradient(to right,transparent,#095484,transparent)}</style><h2 class=book-brand><a href=http://um-grex.github.io/grex-docs><img src=/grex-docs/logo/um_logo_email_signature.png style=width:auto;height:auto alt=Logo><br><hr><span>Unofficial Grex User Guide</span><hr></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64><div class="book-search-spinner spinner hidden"></div><ul id=book-search-results></ul></div><hr><ul><li class=book-section-flat><a href=/grex-docs/docs/longread/>Notes of Grex Changes</a><ul><li class=book-section-flat><a href=/grex-docs/docs/longread/training/>Training Materials and Presentations</a><ul></ul></li></ul></li><li class=book-section-flat><a href=/grex-docs/docs/computecanada/>Accessing Compute Canada resources</a><ul></ul></li><li class=book-section-flat><a href=/grex-docs/docs/grex/>Grex HPC QuickStart</a><ul><li><a href=/grex-docs/docs/grex/access/>Access and Usage conditions</a></li><li><a href=/grex-docs/docs/grex/connecting/>Connecting / Transferring data</a></li><li><a href=/grex-docs/docs/grex/data/>Storage and Data</a></li><li><a href=/grex-docs/docs/grex/running/>Running Jobs</a></li><li><a href=/grex-docs/docs/grex/ood/>Grex's OpenOnDemand Web Portal</a></li><li><a href=/grex-docs/docs/grex/software/>Software</a><ul><li><a href=/grex-docs/docs/grex/software/cern-vmfs/>CVMFS and ComputeCanada</a></li><li><a href=/grex-docs/docs/grex/software/general-linux/>General Linux tools</a></li><li><a href=/grex-docs/docs/grex/software/containers/ class=active>Containers for Software</a></li><li><a href=/grex-docs/docs/grex/software/code-development/>Code Development on Grex</a></li><li><a href=/grex-docs/docs/grex/software/jupyter-notebook/>Using JuPyTer Notebooks</a></li><li><a href=/grex-docs/docs/grex/software/specific/>Software-specific notes</a></li></ul></li></ul></li><li><a href=/grex-docs/docs/faq/>Frequently Asked Questions</a></li><li><a href=/grex-docs/docs/localit/>Local IT Resources</a></li><li><a href=/grex-docs/docs/support-contacts/>Support and Training</a></li><li><a href=/grex-docs/docs/disclaimer/>Disclaimer</a></li></ul></nav><script>(function(){var a=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(b){localStorage.setItem("menu.scrollTop",a.scrollTop)}),a.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></aside><div class=book-page><article class=markdown><h1 id=introduction>Introduction</h1><p>Linux Containers are means to isolate software dependencies from the base Linux operation system. On Grex, we support the <a href=https://sylabs.io/guides/3.5/user-guide/ target=_blank rel=noopener>Singularity</a>
container system, now developed by a company called SyLabs. Several other Linux containers engines exist, most notably <a href=https://www.docker.com target=_blank rel=noopener>Docker</a>
which is a very popular tool in DevOps community. Presently Docker containers cannot be directly supported on shared HPC systems like Grex. However, with help of Singularity, it is possible to run Docker images from the <a href=https://hub.docker.com/ target=_blank rel=noopener>DockerHub</a>
, as well as native Singularity images from other repositories, such as <a href=https://singularity-hub.org/ target=_blank rel=noopener>SingularityHub</a>
and <a href=https://cloud.sylabs.io/home target=_blank rel=noopener>SyLabsCloud</a>
.</p><h2 id=using-singularity-on-grex>Using Singularity on Grex</h2><p>Start with <strong>module spider singularity</strong>; it will list the current version. Due to the nature of container runtime environments, we update Singularity regularly, so the installed version is usually the latest one. Load the module (in the default Grex environment) by the following command:</p><blockquote class="book-hint info"><code>module load singularity</code></blockquote><p>With <strong>singularuty</strong> command, one can list singularity commands and their options:</p><blockquote class="book-hint info"><p><code>module load singularity</code></p><p><code>singularity help</code></p></blockquote><p>A brief introduction on <a href=https://sylabs.io/guides/3.5/user-guide/quick_start.html target=_blank rel=noopener>getting started with Singularity</a>
can be useful to get started. You will not need to install Singularity on Grex since it is already provided as module.</p><p>To execute an application within the container, do it in the usual way for that application, but prefix the command with &lsquo;&lsquo;singularity exec image_name.sif". For example, to run R on an R script, using a container named R-INLA.sif:</p><blockquote class="book-hint info"><code>singularity exec ./R-INLA.sif R --vanilla &lt; myscript.R</code></blockquote><p>Quite often, it is useful to provide the containerized application with data residing on a shared HPC filesystem such as <strong>/home</strong> or <strong>/global/scratch</strong>. This is done via <a href=https://sylabs.io/guides/3.5/user-guide/bind_paths_and_mounts.html target=_blank rel=noopener>bind mounts</a>
. Normally, the container <strong>bind-mounts</strong> $HOME, /tmp and the current working directory. On Grex to bind the global Lustre filesystem the following <strong>-B</strong> option should be used:</p><blockquote class="book-hint info"><code>singularity exec -B /sbb/scratch:/global/scratch ./R-INLA.sif R --vanilla &lt; myscript.R</code></blockquote><p>In case you do not want to mount anything to preserve the containers&rsquo; environment from any overalapping data/code from say $HOME, use the <strong>--containall</strong> flag.</p><p>Some attention has to be paid to Singularity&rsquo;s local cache and temporary directories. Singularity caches the container images it pulls and Docker layers under <strong>$HOME/.singularity</strong>. Containers can be large, in tens of gigabytes, and thus they can easily accumulate and exhaust the users storage space quota on $HOME. Thus users might want to set the <strong>SINGULARITY_CACHEDIR</strong> and <strong>SINGULARITY_TMPDIR</strong> variables to some place under their <strong>/global/scratch</strong> space.</p><p>For example, to change the location of <strong>SINGULARITY_CACHEDIR</strong> and <strong>SINGULARITY_TMPDIR</strong>, ome might run:</p><blockquote class="book-hint info"><p><code>mkdir -p /global/scratch/$USER/singularity/{cache,tmp}</code></p><p><code>export SINGULARITY_CACHEDIR="/global/scratch/$USER/singularity/cache"</code></p><p><code>export SINGULARITY_TMPDIR="/global/scratch/$USER/singularity/tmp"</code></p></blockquote><p>before building the singularity image.</p><h2 id=getting-and-building-singularity-images>Getting and building Singularity images</h2><p>The commands <strong>singularty build</strong> and <strong>singularity pull</strong> would get Singularity images from DockerHub, SingularityHub or SyLabsCloud. Images can also be built from other images, and from recipes. A recipe is a text file that specifies the base image and post-install commands to be performed on it.</p><h2 id=singularity-with-gpus>Singularity with GPUs</h2><p>Use the <strong>--nv</strong> flag to singularity run/exec/shell commands. Naturally, you should be on a node that has a GPU, in an interactive job. NVIDIA provides many pre-built Docker and Singularity container images on their <a href=https://ngc.nvidia.com/ target=_blank rel=noopener>&ldquo;GPU cloud&rdquo;</a>
, together with instructions on how to pull them and to run them. These should work on Grex without much changes.</p><h2 id=opensciencegrid-cvmfs>OpenScienceGrid CVMFS</h2><p>We can run Singularity containers distributed with OSG CVMFS which is currenlly mounted on Grex&rsquo;s CVMFS. The containers are distributed via CVMFS as unpacked directory images. So the way to access them is to find a directory of interest and point singularity runtime to it. The directories will then be mounted and fetched automatically. The repository starts with <strong>/cvmfs/singularity.opensciencegrid.org/</strong>. Then you&rsquo;d need an idea from somewhere what you are looking for in the subdirectories of the above mentioned path. An example (accessing, that is, exploring via <strong>singularity shell</strong> command, Remoll software distributed trough OSG CVMFS by <strong>jeffersonlab</strong>):</p><blockquote class="book-hint info"><p><code>module load singularity</code></p><p><code>singularity shell /cvmfs/singularity.opensciencegrid.org/jeffersonlab/remoll\:develop</code></p></blockquote><p>A partial description of what is present on OSG CVMFS is available <a href=https://support.opensciencegrid.org/support/solutions/articles/12000024676-docker-and-singularity-containers target=_blank rel=noopener>here</a>
.</p><h2 id=more-information>More information</h2><ul><li><a href=https://sylabs.io target=_blank rel=noopener>Singularity/Sylabs homepage</a></li><li><a href=https://docs.computecanada.ca/wiki/Singularity target=_blank rel=noopener>Compute Canada Singularity documentation</a></li><li><a href=https://westgrid.github.io/trainingMaterials/materials/singularity20210526.pdf target=_blank rel=noopener>Westgrid Singularity tutorial</a>
, a recording can be found <a href=https://westgrid.github.io/trainingMaterials/tools/virtual/ target=_blank rel=noopener>here</a></li><li><a href=https://hub.docker.com target=_blank rel=noopener>Docker Hub</a></li><li><a href=https://ngc.nvidia.com/ target=_blank rel=noopener>Singularity Hub</a></li><li><a href=https://cloud.sylabs.io/home target=_blank rel=noopener>Sylabs Cloud</a></li><li><a href=https://ngc.nvidia.com/ target=_blank rel=noopener>NVIDIA NGC cloud</a></li><li><a href=https://support.opensciencegrid.org/support/solutions/articles/12000024676-docker-and-singularity-containers target=_blank rel=noopener>OSG Helpdesk for Singularity</a></li></ul></article><div class="book-footer justify-between"><div><a class="flex align-center" href=https://github.com/um-grex/grex-docs/commit/4a07d74120d95d4386c1c274f941df41cb1cc57e title="Last modified by Shamov | Feb 16, 2022" target=_blank><img src=/grex-docs/svg/calendar.svg class=book-icon alt=Calendar>
<span>Feb 16, 2022</span></a></div><div><a class="flex align-center" href=https://github.com/um-grex/grex-docs/blob/master/content/docs/grex/software/containers.md target=_blank><img src=/grex-docs/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div><br><hr></div><aside class="book-toc levels-4 fixed"><nav id=TableOfContents><ul><li><a href=#introduction>Introduction</a><ul><li><a href=#using-singularity-on-grex>Using Singularity on Grex</a></li><li><a href=#getting-and-building-singularity-images>Getting and building Singularity images</a></li><li><a href=#singularity-with-gpus>Singularity with GPUs</a></li><li><a href=#opensciencegrid-cvmfs>OpenScienceGrid CVMFS</a></li><li><a href=#more-information>More information</a></li></ul></li></ul></nav></aside></main></body></html>