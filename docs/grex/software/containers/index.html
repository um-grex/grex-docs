<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Containers for Software"><meta property="og:title" content="Containers for Software"><meta property="og:description" content="Introduction Linux Containers are means to isolate software dependencies from the base Linux operation system. On Grex, we support the Singularity container system, now developed by a company called SyLabs. Several other Linux containers engines exist, most notably Docker which is a very popular tool in DevOps community. Presently Docker containers cannot be directly supported on shared HPC systems like Grex. However, with help of Singularity it is possible to run Docker images from the DockerHub, as well as native Singularity images from other repositories, such as SingularityHub and SyLabsCloud."><meta property="og:type" content="article"><meta property="og:url" content="http://um-grex.github.io/grex-docs/docs/grex/software/containers/"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2021-06-29T07:58:23-05:00"><title>Containers for Software | Unofficial Grex User Guide</title><link rel=icon href=/grex-docs/favicon.png type=image/x-icon><link rel=stylesheet href=/grex-docs/book.min.9e24c4795dd4fdd0e504b497cfd7198ef04d9fc59147fe183e68ca7912ee2901.css integrity="sha256-niTEeV3U/dDlBLSXz9cZjvBNn8WRR/4YPmjKeRLuKQE="><script defer src=/grex-docs/en.search.min.686566d2f12071b22d28aeb63f12f08ba1936e48160b1d534d6a1b2dfe9efc98.js integrity="sha256-aGVm0vEgcbItKK62PxLwi6GTbkgWCx1TTWobLf6e/Jg="></script></head><body><input type=checkbox class=hidden id=menu-control><main class="flex container"><aside class="book-menu fixed"><nav><h2 class=book-brand><a href=http://um-grex.github.io/grex-docs><img src=/grex-docs/um_logo_email_signature.png alt=Logo><span>Unofficial Grex User Guide</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64><div class="book-search-spinner spinner hidden"></div><ul id=book-search-results></ul></div><ul><li class=book-section-flat><a href=/grex-docs/docs/longread/>Notes of Grex Changes</a><ul><li class=book-section-flat><a href=/grex-docs/docs/longread/training/>Training Materials and Presentations</a><ul></ul></li></ul></li><li class=book-section-flat><a href=/grex-docs/docs/computecanada/>Accessing Compute Canada resources</a><ul></ul></li><li class=book-section-flat><a href=/grex-docs/docs/grex/>Grex HPC Documentation</a><ul><li><a href=/grex-docs/docs/grex/access/>Access and Usage conditions</a></li><li><a href=/grex-docs/docs/grex/connecting/>Connecting / Transferring data</a></li><li><a href=/grex-docs/docs/grex/data/>Storage and Data</a></li><li><a href=/grex-docs/docs/grex/running/>Running Jobs</a></li><li><a href=/grex-docs/docs/grex/software/>Software</a><ul><li><a href=/grex-docs/docs/grex/software/cern-vmfs/>CVMFS and ComputeCanada</a></li><li><a href=/grex-docs/docs/grex/software/general-linux/>General Linux tools</a></li><li><a href=/grex-docs/docs/grex/software/containers/ class=active>Containers for Software</a></li><li><a href=/grex-docs/docs/grex/software/code-development/>Code Development on Grex</a></li><li><span>Software-specific notes</span><ul><li><a href=/grex-docs/docs/grex/software/specific/gaussian/>Gaussian</a></li><li><a href=/grex-docs/docs/grex/software/specific/julia/>Julia</a></li><li><a href=/grex-docs/docs/grex/software/specific/matlab/>Matlab</a></li><li><a href=/grex-docs/docs/grex/software/specific/nwchem/>Nwchem</a></li><li><a href=/grex-docs/docs/grex/software/specific/orca/>Orca</a></li><li><a href=/grex-docs/docs/grex/software/specific/priroda/>Priroda</a></li><li><a href=/grex-docs/docs/grex/software/specific/vasp/>Vasp</a></li></ul></li></ul></li></ul></li><li><a href=/grex-docs/docs/faq/>Frequently Asked Questions</a></li><li><a href=/grex-docs/docs/localit/>Local IT Resources</a></li><li><a href=/grex-docs/docs/support-contacts/>Support and Training</a></li><li><a href=/grex-docs/docs/disclaimer/>Disclaimer</a></li></ul></nav><script>(function(){var a=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(b){localStorage.setItem("menu.scrollTop",a.scrollTop)}),a.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></aside><div class=book-page><header class="flex align-center justify-between book-header"><label for=menu-control><img src=/grex-docs/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Containers for Software</strong></header><article class=markdown><h1 id=introduction>Introduction</h1><p>Linux Containers are means to isolate software dependencies from the base Linux operation system. On Grex, we support the <a href=https://sylabs.io/guides/3.5/user-guide/>Singularity</a> container system, now developed by a company called SyLabs. Several other Linux containers engines exist, most notably <a href=https://www.docker.com>Docker</a> which is a very popular tool in DevOps community. Presently Docker containers cannot be directly supported on shared HPC systems like Grex. However, with help of Singularity it is possible to run Docker images from the <a href=https://hub.docker.com/>DockerHub</a>, as well as native Singularity images from other repositories, such as <a href=https://singularity-hub.org/>SingularityHub</a> and <a href=https://cloud.sylabs.io/home>SyLabsCloud</a>.</p><h2 id=using-singularity-on-grex>Using Singularity on Grex</h2><p>Start with &lsquo;module spider singularity&rsquo;; it will list the current version. Due to the nature of container runtime environments, we update Singularity regularly, so the installed version is usually the latest one. Load the module (in the default Grex environment) by the following command:</p><p><code>module load singularity</code></p><p>With <strong>singularuty</strong> command, one can list singularity commands and their options:</p><p><code>singularity help</code></p><p>A brief introduction on <a href=https://sylabs.io/guides/3.5/user-guide/quick_start.html>getting started with Singularity</a> can be useful to get started. You will not need to install Singularity on Grex since it is already provided as module.</p><p>To execute an application within the container, do it in the usual way for that application, but prefix the command with &lsquo;&lsquo;singularity exec image_name.sif". For example, to run R on an R script, using a container named R-INLA.sif:</p><p><code>singularity exec ./R-INLA.sif R --vanilla &lt; myscript.R</code></p><p>Quite often, it is useful to provide the containerized application with data residing on a shared HPC filesystem such as <em>/home</em> or <em>/global/scratch</em>. This is done via <a href=https://sylabs.io/guides/3.5/user-guide/bind_paths_and_mounts.html>bind mounts</a>. Normally, the container <strong>bind-mounts</strong> $HOME, /tmp and the current working directory. On Grex to bind the global Lustre filesystem the following <em>-B</em> option should be used:</p><p><code>singularity exec -B /sbb/scratch:/global/scratch ./R-INLA.sif R --vanilla &lt; myscript.R</code></p><p>In case you do not want to mount anything to preserve the containers&rsquo; environment from any overalapping data/code from say $HOME, use the <em>&ndash;containall</em> flag.</p><p>Some attention has to be paid to Singularity&rsquo;s local cache and temporary directories. Singularity caches the container images it pulls and Docker layers under <em>$HOME/.singularity</em>. Containers can be large, in tens of gigabytes, and thus they can easily accumulate and exhaust the users storage space quota on $HOME. Thus users might want to set the SINGULARITY_CACHEDIR and SINGULARITY_TMPDIR variables to some place under their <em>/global/scratch</em> space.</p><h2 id=getting-and-building-singularity-images>Getting and building Singularity images</h2><p>The commands &lsquo;&lsquo;singularty build&rsquo;&rsquo; and &lsquo;&lsquo;singularity pull&rsquo;&rsquo; would get Singularity images from DockerHub, SingularityHub or SyLabsCloud. Images can also be built from other images, and from recipes. A recipe is a text file that specifies the base image and post-install commands to be performed on it.</p><h2 id=singularity-with-gpus>Singularity with GPUs</h2><p>Use the &lsquo;'&ndash;nv&rsquo;&rsquo; flag to singularity run/exec/shell commands. Naturally, you should be on a node that has a GPU, in an interactive job. NVIDIA provides many pre-built Docker and Singularity container images on their <a href=https://ngc.nvidia.com/>&ldquo;GPU cloud&rdquo;</a>, together with instructions on how to pull them and to run them. These should work on Grex without much changes.</p><h2 id=opensciencegrid-cvmfs>OpenScienceGrid CVMFS</h2><p>We can run Singularity containers distributed with OSG CVMFS which is currenlly mounted on Grex&rsquo;s CVMFS. The containers are distributed via CVMFS
as unpacked directory images. So the way to access them is to find a directory of interest and point singularity runtime to it. The directories will
then be mounted and fetched automatically. The repository starts with _/cvmfs/singularity.opensciencegrid.org/. Then you&rsquo;d need an idea from somewhere what you are looking for in the
subdirectories of the above mentioned path. An example (accessing, that is, exploring via <em>singularity shell</em> command, Remoll software distributed tgriugh OSG CVMFS by <em>jeffersonlab</em>):</p><p><code>module load singularity</code></p><p><code>singularity shell /cvmfs/singularity.opensciencegrid.org/jeffersonlab/remoll\:develop</code></p><p>A partial description of what is present on OSG CVMFS is available <a href=https://support.opensciencegrid.org/support/solutions/articles/12000024676-docker-and-singularity-containers>here</a>.</p><h2 id=more-information>More information</h2><ul><li><a href=https://sylabs.io>Singularity/Sylabs homepage</a></li><li><a href=https://docs.computecanada.ca/wiki/Singularity>ComputeCanada Singularity documentation</a></li><li><a href>Westgrid Singularity tutorial</a></li><li><a href=https://hub.docker.com>Docker Hub</a></li><li><a href=https://ngc.nvidia.com/>Singularity Hub</a></li><li><a href=https://cloud.sylabs.io/home>Sylabs Cloud</a></li><li><a href=https://ngc.nvidia.com/>NVIDIA NGC cloud</a></li><li><a href=https://support.opensciencegrid.org/support/solutions/articles/12000024676-docker-and-singularity-containers>OSG Helpdesk for Singularity</a></li></ul></article><div class="book-footer justify-between"><div><a class="flex align-center" href=https://github.com/um-grex/grex-docs/commit/f42cd442db68ea019509b0aa26c742457dd13f71 title="Last modified by Shamov | Jun 29, 2021" target=_blank><img src=/grex-docs/svg/calendar.svg class=book-icon alt=Calendar>
<span>Jun 29, 2021</span></a></div><div><a class="flex align-center" href=https://github.com/um-grex/grex-docs/blob/master/content/docs/grex/software/containers.md target=_blank><img src=/grex-docs/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div></div><aside class="book-toc levels-4 fixed"><nav id=TableOfContents><ul><li><a href=#introduction>Introduction</a><ul><li><a href=#using-singularity-on-grex>Using Singularity on Grex</a></li><li><a href=#getting-and-building-singularity-images>Getting and building Singularity images</a></li><li><a href=#singularity-with-gpus>Singularity with GPUs</a></li><li><a href=#opensciencegrid-cvmfs>OpenScienceGrid CVMFS</a></li><li><a href=#more-information>More information</a></li></ul></li></ul></nav></aside></main></body></html>